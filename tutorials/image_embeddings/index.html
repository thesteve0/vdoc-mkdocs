
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Using Image Embeddings ¶ - Voxel51 Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#using-image-embeddings" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Voxel51 Documentation" class="md-header__button md-logo" aria-label="Voxel51 Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Voxel51 Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Using Image Embeddings ¶
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/thesteve0/vdoc-mkdocs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Voxel51 Documentation" class="md-nav__button md-logo" aria-label="Voxel51 Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Voxel51 Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/thesteve0/vdoc-mkdocs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/virtualenv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virtualenvs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/datasets_samples_fields/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Datasets, Samples, and Fields
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/application_tour/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tour of the Applications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../fiftyone_concepts/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    FiftyOne Concepts
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            FiftyOne Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fiftyone_concepts/basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../brain/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Machine Learning
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How Do I
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../data_and_models/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Data and Models
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Data and Models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../data_and_models/dataset_zoo/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Zoo Datasets
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Zoo Datasets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_and_models/dataset_zoo/datasets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Built-In Zoo Datasets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_and_models/dataset_zoo/remote/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remotely-Sourced Zoo Datasets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_and_models/dataset_zoo/api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zoo Data API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_and_models/hugging_face_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hugging Face Datasets
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrations
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
          
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../api/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    References
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            References
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLI
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../community/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Community
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../teams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fifty One Teams
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Releases
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      Setup ¶
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-i-mnist" class="md-nav__link">
    <span class="md-ellipsis">
      Part I: MNIST ¶
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part I: MNIST ¶">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#computing-image-embeddings" class="md-nav__link">
    <span class="md-ellipsis">
      Computing image embeddings ¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualization-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Visualization parameters ¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualizing-embeddings" class="md-nav__link">
    <span class="md-ellipsis">
      Visualizing embeddings ¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scatterplot-controls" class="md-nav__link">
    <span class="md-ellipsis">
      Scatterplot controls ¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploring-the-embeddings" class="md-nav__link">
    <span class="md-ellipsis">
      Exploring the embeddings ¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pre-annotation-of-samples" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-annotation of samples ¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-existing-visualizations" class="md-nav__link">
    <span class="md-ellipsis">
      Loading existing visualizations ¶
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-ii-bdd100k" class="md-nav__link">
    <span class="md-ellipsis">
      Part II: BDD100K ¶
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part II: BDD100K ¶">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#computing-image-embeddings_1" class="md-nav__link">
    <span class="md-ellipsis">
      Computing image embeddings ¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualizing-embeddings_1" class="md-nav__link">
    <span class="md-ellipsis">
      Visualizing embeddings ¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#investigating-outliers" class="md-nav__link">
    <span class="md-ellipsis">
      Investigating outliers ¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tagging-label-mistakes" class="md-nav__link">
    <span class="md-ellipsis">
      Tagging label mistakes ¶
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary ¶
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/thesteve0/vdoc-mkdocs/blob/main/docs/tutorials/image_embeddings.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="using-image-embeddings">Using Image Embeddings <a href="#Using-Image-Embeddings" title="Permalink to this headline">¶</a><a class="headerlink" href="#using-image-embeddings" title="Permanent link">&para;</a></h1>
<p>FiftyOne provides a powerful <a href="https://voxel51.com/docs/fiftyone/user_guide/brain.html#visualizing-embeddings">embeddings visualization</a> capability that you can use to generate low-dimensional representations of the samples and objects in your datasets.</p>
<p>This notebook highlights several applications of visualizing image embeddings, with the goal of motivating some of the many possible workflows that you can perform.</p>
<p>Specifically, we’ll cover the following concepts:</p>
<ul>
<li>
<p>Loading datasets from the <a href="https://voxel51.com/docs/fiftyone/user_guide/dataset_zoo_datasets.html">FiftyOne Dataset Zoo</a></p>
</li>
<li>
<p>Using <a href="https://voxel51.com/docs/fiftyone/api/fiftyone.brain.html#fiftyone.brain.compute_visualization">compute_visualization()</a> to generate 2D representations of images</p>
</li>
<li>
<p>Providing custom embeddings to <a href="https://voxel51.com/docs/fiftyone/api/fiftyone.brain.html#fiftyone.brain.compute_visualization">compute_visualization()</a></p>
</li>
<li>
<p>Visualizing embeddings via <a href="https://voxel51.com/docs/fiftyone/user_guide/plots.html">interactive plots</a> connected to the <a href="https://voxel51.com/docs/fiftyone/user_guide/app.html">FiftyOne App</a></p>
</li>
</ul>
<p>And we’ll demonstrate how to use embeddings to:</p>
<ul>
<li>
<p>Identify anomolous/incorrect image labels</p>
</li>
<li>
<p>Find examples of scenarios of interest</p>
</li>
<li>
<p>Pre-annotate unlabeled data for training</p>
</li>
</ul>
<p><strong>So, what’s the takeaway?</strong></p>
<p>Combing through individual images in a dataset and staring at aggregate performance metrics trying to figure out how to improve the performance of a model is an ineffective and time-consuming process. Visualizing your dataset in a low-dimensional embedding space is a powerful workflow that can reveal patterns and clusters in your data that can answer important questions about the critical failure modes of your model and how to augment your dataset to address these failures.</p>
<p>Using the FiftyOne Brain’s <a href="https://voxel51.com/docs/fiftyone/user_guide/brain.html#visualizing-embeddings">embeddings visualization</a> capability on your ML projects can help you uncover hidden patterns in your data and take action to improve the quality of your datasets and models.</p>
<p><img alt="embeddings-sizzle" src="../../_images/image_embeddings_zero_cluster.gif" /></p>
<h2 id="setup">Setup <a href="#Setup" title="Permalink to this headline">¶</a><a class="headerlink" href="#setup" title="Permanent link">&para;</a></h2>
<p>If you haven’t already, install FiftyOne:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">fiftyone</span>
</span></code></pre></div>
<p>In this tutorial, we’ll use some PyTorch models to generate embeddings, and we’ll use the (default) <a href="https://github.com/lmcinnes/umap">UMAP method</a> to generate embeddings, so we’ll need to install the corresponding packages:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">torch</span> <span class="n">torchvision</span> <span class="n">umap</span><span class="o">-</span><span class="n">learn</span>
</span></code></pre></div>
<p>This tutorial will demonstrate the powerful <a href="https://voxel51.com/docs/fiftyone/user_guide/plots.html">interactive plotting</a> capabilities of FiftyOne. In the FiftyOne App, you can bidirectionally interact with plots to identify interesting subsets of your data and take action on them!</p>
<h2 id="part-i-mnist">Part I: MNIST <a href="#Part-I:-MNIST" title="Permalink to this headline">¶</a><a class="headerlink" href="#part-i-mnist" title="Permanent link">&para;</a></h2>
<p>In this section, we’ll be working with the <a href="https://voxel51.com/docs/fiftyone/user_guide/dataset_zoo/datasets.html?highlight=mnist#dataset-zoo-mnist">MNIST dataset</a> from the FiftyOne Dataset Zoo.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><span class="kn">import</span><span class="w"> </span><span class="nn">fiftyone</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">fo</span>
</span><span id="__span-5-2"><span class="kn">import</span><span class="w"> </span><span class="nn">fiftyone.zoo</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">foz</span>
</span><span id="__span-5-3">
</span><span id="__span-5-4"><span class="n">dataset</span> <span class="o">=</span> <span class="n">foz</span><span class="o">.</span><span class="n">load_zoo_dataset</span><span class="p">(</span><span class="s2">&quot;mnist&quot;</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><span class="n">Split</span> <span class="s1">&#39;train&#39;</span> <span class="n">already</span> <span class="n">downloaded</span>
</span><span id="__span-6-2"><span class="n">Split</span> <span class="s1">&#39;test&#39;</span> <span class="n">already</span> <span class="n">downloaded</span>
</span><span id="__span-6-3"><span class="n">Loading</span> <span class="n">existing</span> <span class="n">dataset</span> <span class="s1">&#39;mnist&#39;</span><span class="o">.</span> <span class="n">To</span> <span class="n">reload</span> <span class="kn">from</span><span class="w"> </span><span class="nn">disk</span><span class="p">,</span> <span class="n">either</span> <span class="n">delete</span> <span class="n">the</span> <span class="n">existing</span> <span class="n">dataset</span> <span class="ow">or</span> <span class="n">provide</span> <span class="n">a</span> <span class="n">custom</span> <span class="err">`</span><span class="n">dataset_name</span><span class="err">`</span> <span class="n">to</span> <span class="n">use</span>
</span></code></pre></div>
<p>To start, we’ll just use the 10,00010,000 test images from the dataset.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><span class="p">[</span><span class="mi">8</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><span class="n">test_split</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">match_tags</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><span class="p">[</span><span class="mi">10</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><span class="nb">print</span><span class="p">(</span><span class="n">test_split</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><span class="n">Dataset</span><span class="p">:</span>     <span class="n">mnist</span>
</span><span id="__span-11-2"><span class="n">Media</span> <span class="nb">type</span><span class="p">:</span>  <span class="n">image</span>
</span><span id="__span-11-3"><span class="n">Num</span> <span class="n">samples</span><span class="p">:</span> <span class="mi">10000</span>
</span><span id="__span-11-4"><span class="n">Sample</span> <span class="n">fields</span><span class="p">:</span>
</span><span id="__span-11-5">    <span class="nb">id</span><span class="p">:</span>           <span class="n">fiftyone</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">ObjectIdField</span>
</span><span id="__span-11-6">    <span class="n">filepath</span><span class="p">:</span>     <span class="n">fiftyone</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">StringField</span>
</span><span id="__span-11-7">    <span class="n">tags</span><span class="p">:</span>         <span class="n">fiftyone</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">ListField</span><span class="p">(</span><span class="n">fiftyone</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">StringField</span><span class="p">)</span>
</span><span id="__span-11-8">    <span class="n">metadata</span><span class="p">:</span>     <span class="n">fiftyone</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">EmbeddedDocumentField</span><span class="p">(</span><span class="n">fiftyone</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">ImageMetadata</span><span class="p">)</span>
</span><span id="__span-11-9">    <span class="n">ground_truth</span><span class="p">:</span> <span class="n">fiftyone</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">EmbeddedDocumentField</span><span class="p">(</span><span class="n">fiftyone</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">Classification</span><span class="p">)</span>
</span><span id="__span-11-10"><span class="n">View</span> <span class="n">stages</span><span class="p">:</span>
</span><span id="__span-11-11">    <span class="mf">1.</span> <span class="n">MatchTags</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="computing-image-embeddings">Computing image embeddings <a href="#Computing-image-embeddings" title="Permalink to this headline">¶</a><a class="headerlink" href="#computing-image-embeddings" title="Permanent link">&para;</a></h3>
<p>Typically when generating low-dimensional representations of image datasets, one will use a deep model to generate embeddings for each image, say 1024 or 2028 dimensional, that are then passed to a dimensionality reduction method like <a href="https://github.com/lmcinnes/umap">UMAP</a> or <a href="https://lvdmaaten.github.io/tsne">t-SNE</a> to generate the 2D or 3D representation that is visualized.</p>
<p>Such an intermediate embedding step is necessary when the images in the dataset have different sizes, or are too large for <a href="https://github.com/lmcinnes/umap">UMAP</a> or <a href="https://lvdmaaten.github.io/tsne">t-SNE</a> to directly process, or the dataset is too complex and a model trained to recognize the concepts of interest is required in order to produce interpretable embeddings.</p>
<p>However, for a relatively small and fixed size dataset such as MNIST, we can pass the images themselves to the dimensionality reduction method.</p>
<p>Let’s use the <a href="https://voxel51.com/docs/fiftyone/api/fiftyone.brain.html#fiftyone.brain.compute_visualization">compute_visualization()</a> method to generate our first representation:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><span class="p">[</span><span class="mi">11</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
</span><span id="__span-13-2"><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="__span-13-3">
</span><span id="__span-13-4"><span class="kn">import</span><span class="w"> </span><span class="nn">fiftyone.brain</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">fob</span>
</span><span id="__span-13-5">
</span><span id="__span-13-6"><span class="c1"># Construct a ``num_samples x num_pixels`` array of images</span>
</span><span id="__span-13-7"><span class="n">embeddings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>\
</span><span id="__span-13-8">    <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_UNCHANGED</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>\
</span><span id="__span-13-9">    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">test_split</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s2">&quot;filepath&quot;</span><span class="p">)</span>\
</span><span id="__span-13-10"><span class="p">])</span>
</span><span id="__span-13-11">
</span><span id="__span-13-12"><span class="c1"># Compute 2D representation</span>
</span><span id="__span-13-13"><span class="n">results</span> <span class="o">=</span> <span class="n">fob</span><span class="o">.</span><span class="n">compute_visualization</span><span class="p">(</span>
</span><span id="__span-13-14">    <span class="n">test_split</span><span class="p">,</span>
</span><span id="__span-13-15">    <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
</span><span id="__span-13-16">    <span class="n">num_dims</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-13-17">    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;umap&quot;</span><span class="p">,</span>
</span><span id="__span-13-18">    <span class="n">brain_key</span><span class="o">=</span><span class="s2">&quot;mnist_test&quot;</span><span class="p">,</span>
</span><span id="__span-13-19">    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-13-20">    <span class="n">seed</span><span class="o">=</span><span class="mi">51</span><span class="p">,</span>
</span><span id="__span-13-21"><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><span class="n">Generating</span> <span class="n">visualization</span><span class="o">...</span>
</span><span id="__span-14-2"><span class="n">UMAP</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">51</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-14-3"><span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">27</span> <span class="mi">11</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">43</span> <span class="mi">2024</span> <span class="n">Construct</span> <span class="n">fuzzy</span> <span class="n">simplicial</span> <span class="nb">set</span>
</span><span id="__span-14-4"><span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">27</span> <span class="mi">11</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">43</span> <span class="mi">2024</span> <span class="n">Finding</span> <span class="n">Nearest</span> <span class="n">Neighbors</span>
</span><span id="__span-14-5"><span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">27</span> <span class="mi">11</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">43</span> <span class="mi">2024</span> <span class="n">Building</span> <span class="n">RP</span> <span class="n">forest</span> <span class="k">with</span> <span class="mi">10</span> <span class="n">trees</span>
</span><span id="__span-14-6"><span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">27</span> <span class="mi">11</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">43</span> <span class="mi">2024</span> <span class="n">NN</span> <span class="n">descent</span> <span class="k">for</span> <span class="mi">13</span> <span class="n">iterations</span>
</span><span id="__span-14-7">         <span class="mi">1</span>  <span class="o">/</span>  <span class="mi">13</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">Caskroom</span><span class="o">/</span><span class="n">miniforge</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">fo</span><span class="o">-</span><span class="n">dev</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.9</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">umap</span><span class="o">/</span><span class="n">umap_</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1943</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="n">n_jobs</span> <span class="n">value</span> <span class="o">-</span><span class="mi">1</span> <span class="n">overridden</span> <span class="n">to</span> <span class="mi">1</span> <span class="n">by</span> <span class="n">setting</span> <span class="n">random_state</span><span class="o">.</span> <span class="n">Use</span> <span class="n">no</span> <span class="n">seed</span> <span class="k">for</span> <span class="n">parallelism</span><span class="o">.</span>
</span><span id="__span-15-2">  <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n_jobs value </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_jobs</span><span class="si">}</span><span class="s2"> overridden to 1 by setting random_state. Use no seed for parallelism.&quot;</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1">         <span class="mi">2</span>  <span class="o">/</span>  <span class="mi">13</span>
</span><span id="__span-16-2">         <span class="mi">3</span>  <span class="o">/</span>  <span class="mi">13</span>
</span><span id="__span-16-3">         <span class="mi">4</span>  <span class="o">/</span>  <span class="mi">13</span>
</span><span id="__span-16-4">        <span class="n">Stopping</span> <span class="n">threshold</span> <span class="n">met</span> <span class="o">--</span> <span class="n">exiting</span> <span class="n">after</span> <span class="mi">4</span> <span class="n">iterations</span>
</span><span id="__span-16-5"><span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">27</span> <span class="mi">11</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">43</span> <span class="mi">2024</span> <span class="n">Finished</span> <span class="n">Nearest</span> <span class="n">Neighbor</span> <span class="n">Search</span>
</span><span id="__span-16-6"><span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">27</span> <span class="mi">11</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">43</span> <span class="mi">2024</span> <span class="n">Construct</span> <span class="n">embedding</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1">        <span class="n">completed</span>  <span class="mi">0</span>  <span class="o">/</span>  <span class="mi">500</span> <span class="n">epochs</span>
</span><span id="__span-17-2">        <span class="n">completed</span>  <span class="mi">50</span>  <span class="o">/</span>  <span class="mi">500</span> <span class="n">epochs</span>
</span><span id="__span-17-3">        <span class="n">completed</span>  <span class="mi">100</span>  <span class="o">/</span>  <span class="mi">500</span> <span class="n">epochs</span>
</span><span id="__span-17-4">        <span class="n">completed</span>  <span class="mi">150</span>  <span class="o">/</span>  <span class="mi">500</span> <span class="n">epochs</span>
</span><span id="__span-17-5">        <span class="n">completed</span>  <span class="mi">200</span>  <span class="o">/</span>  <span class="mi">500</span> <span class="n">epochs</span>
</span><span id="__span-17-6">        <span class="n">completed</span>  <span class="mi">250</span>  <span class="o">/</span>  <span class="mi">500</span> <span class="n">epochs</span>
</span><span id="__span-17-7">        <span class="n">completed</span>  <span class="mi">300</span>  <span class="o">/</span>  <span class="mi">500</span> <span class="n">epochs</span>
</span><span id="__span-17-8">        <span class="n">completed</span>  <span class="mi">350</span>  <span class="o">/</span>  <span class="mi">500</span> <span class="n">epochs</span>
</span><span id="__span-17-9">        <span class="n">completed</span>  <span class="mi">400</span>  <span class="o">/</span>  <span class="mi">500</span> <span class="n">epochs</span>
</span><span id="__span-17-10">        <span class="n">completed</span>  <span class="mi">450</span>  <span class="o">/</span>  <span class="mi">500</span> <span class="n">epochs</span>
</span><span id="__span-17-11"><span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">27</span> <span class="mi">11</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">56</span> <span class="mi">2024</span> <span class="n">Finished</span> <span class="n">embedding</span>
</span></code></pre></div>
<p>The method returned a <code>results</code> object with a <code>points</code> attribute that contains a <code>10000 x 2</code> array of 2D embeddings for our samples that we’ll visualize next.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><span class="p">[</span><span class="mi">12</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</span><span id="__span-19-2"><span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="err">&#39;</span><span class="nc">fiftyone</span><span class="o">.</span><span class="n">brain</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">VisualizationResults</span><span class="s1">&#39;&gt;</span>
</span><span id="__span-20-2"><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></code></pre></div>
<p>If you ever want to access this results object again from the dataset, you can do so with the dataset’s <code>load_brain_results()</code> method, passing the <code>brain_key</code> that you used to store the results:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><span class="p">[</span><span class="mi">13</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><span class="n">dataset</span><span class="o">.</span><span class="n">load_brain_results</span><span class="p">(</span><span class="s2">&quot;mnist_test&quot;</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><span class="p">[</span><span class="mi">13</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><span class="o">&lt;</span><span class="n">fiftyone</span><span class="o">.</span><span class="n">brain</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">VisualizationResults</span> <span class="n">at</span> <span class="mh">0x2c8918c40</span><span class="o">&gt;</span>
</span></code></pre></div>
<h3 id="visualization-parameters">Visualization parameters <a href="#Visualization-parameters" title="Permalink to this headline">¶</a><a class="headerlink" href="#visualization-parameters" title="Permanent link">&para;</a></h3>
<p>There are two primary components to an embedding visualization: the method used to generate the embeddings, and the dimensionality reduction method used to compute a low-dimensional representation of the embeddings.</p>
<p>The <code>embeddings</code> and <code>model</code> parameters of <a href="https://voxel51.com/docs/fiftyone/api/fiftyone.brain.html#fiftyone.brain.compute_visualization">compute_visualization()</a> support a variety of ways to generate embeddings for your data:</p>
<ul>
<li>
<p>Provide nothing, in which case a default general-purpose model is used to embed your data</p>
</li>
<li>
<p>Provide a <a href="https://voxel51.com/docs/fiftyone/api/fiftyone.core.models.html#fiftyone.core.models.Model">Model instance</a> or the name of any model from the <a href="https://voxel51.com/docs/fiftyone/user_guide/model_zoo/index.html">FiftyOne Model Zoo</a> that supports embeddings</p>
</li>
<li>
<p>Compute your own embeddings and provide them as an array</p>
</li>
<li>
<p>Specify the name of a field of your dataset in which embeddings are stored</p>
</li>
</ul>
<p>The <code>method</code> parameter of <a href="https://voxel51.com/docs/fiftyone/api/fiftyone.brain.html#fiftyone.brain.compute_visualization">compute_visualization()</a> allows you to specify the dimensionality reduction method to use. The supported methods are:</p>
<ul>
<li>
<p><code>"umap"</code> <strong>(default)</strong>: Uniform Manifold Approximation and Projection ( <a href="https://github.com/lmcinnes/umap">UMAP</a>)</p>
</li>
<li>
<p><code>"t-sne"</code>: t-distributed Stochastic Neighbor Embedding ( <a href="https://lvdmaaten.github.io/tsne">t-SNE</a>)</p>
</li>
<li>
<p><code>"pca"</code>: Principal Component Analysis ( <a href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.PCA.html">PCA</a>)</p>
</li>
</ul>
<h3 id="visualizing-embeddings">Visualizing embeddings <a href="#Visualizing-embeddings" title="Permalink to this headline">¶</a><a class="headerlink" href="#visualizing-embeddings" title="Permanent link">&para;</a></h3>
<p>Now we’re ready to use <a href="https://voxel51.com/docs/fiftyone/api/fiftyone.brain.visualization.html#fiftyone.brain.visualization.VisualizationResults.visualize">results.visualize()</a> to visualize our representation.</p>
<p>Although we could use this method in isolation, the real power of FiftyOne comes when you <a href="https://voxel51.com/docs/fiftyone/user_guide/plots.html#attaching-plots">attach plots to the FiftyOne App</a>, so that when points of interest are selected in the plot, the corresponding samples are automatically selected in the App, and vice versa.</p>
<p>So, let’s open the test split in the App:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-26-1"><span class="c1"># Launch App instance</span>
</span><span id="__span-26-2"><span class="n">session</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">launch_app</span><span class="p">(</span><span class="n">test_split</span><span class="p">)</span>
</span></code></pre></div>
<p><img alt="MNIST test split" src="../../_images/image_embeddings_test_split.png" /></p>
<p>Now let’s visualize the results in the <a href="https://docs.voxel51.com/user_guide/app.html#embeddings-panel">Embeddings Panel</a> in the FiftyOne App, and color by ground truth label:</p>
<p><img alt="MNIST embeddings" src="../../_images/image_embeddings_panel.gif" /></p>
<p>Notice that the scatterpoints are naturally clustered by color (ground truth label), which means that <a href="https://github.com/lmcinnes/umap">UMAP</a> was able to capture the visual differences between the digits!</p>
<h3 id="scatterplot-controls">Scatterplot controls <a href="#Scatterplot-controls" title="Permalink to this headline">¶</a><a class="headerlink" href="#scatterplot-controls" title="Permanent link">&para;</a></h3>
<p>Now it’s time to explore the scatterplot interactively. In the top of the panel, you will see controls that allow you to do the following: - The <code>Zoom</code>, <code>Pan</code>, <code>Zoom In</code>, <code>Zoom Out</code>, <code>Autoscale</code>, and <code>Reset axes</code> modes can be used to manipulate your current view - The <code>Box Select</code> and <code>Lasso Select</code> modes enable you to select points in the plot</p>
<p>In <code>Box Select</code> or <code>Lasso Select</code> mode, drawing on the plot will select the points within the region you define. In addition, note that you can: - Hold shift to add a region to your selection - Double-click anywhere on the plot to deselect all points</p>
<p>Since we chose a categorical label for the points, each ground truth label is given its own trace in the legend on the righthand side. You can interact with this legend to show/hide data: - Single-click on a trace to show/hide all points in that trace - Double-click on a trace to show/hide all <em>other</em> traces</p>
<h3 id="exploring-the-embeddings">Exploring the embeddings <a href="#Exploring-the-embeddings" title="Permalink to this headline">¶</a><a class="headerlink" href="#exploring-the-embeddings" title="Permanent link">&para;</a></h3>
<p>Here’s a couple suggestions for exploring the data:</p>
<ul>
<li>
<p>Use <code>Lasso Select</code> to select the cluster of points corresponding to the <code>0</code> label. Note that the corresponding images loaded in the App are all images of zeros, as expected</p>
</li>
<li>
<p>Try selecting other clusters and viewing the images in the App</p>
</li>
<li>
<p>Click on the <code>0</code> label in the legend to hide the zeros. Now lasso the points from other traces that are in the <code>0</code> cluster. These are non-zero images in the dataset that are likley to be confused as zeros!</p>
</li>
</ul>
<p><img alt="likely zero confusions" src="../../_images/image_embeddings_zero_cluster.gif" /></p>
<p>Now try double-clicking on the <code>0</code> legend entry so that only the <code>0</code> points are visible in the plot. Then use the <code>Lasso Select</code> to select the <code>0</code> points that are far away from the main <code>0</code> cluster. These are zero images in the dataset that are likely to be confused as non-zeroes by a model!</p>
<p><img alt="likely nonzero confusions" src="../../_images/image_embeddings_nonzero_cluster.gif" /></p>
<p>Cool, right? It is clear that <a href="https://voxel51.com/docs/fiftyone/api/fiftyone.brain.html#fiftyone.brain.compute_visualization">compute_visualization()</a> has picked up on some interesting structure in the test split of the dataset.</p>
<h3 id="pre-annotation-of-samples">Pre-annotation of samples <a href="#Pre-annotation-of-samples" title="Permalink to this headline">¶</a><a class="headerlink" href="#pre-annotation-of-samples" title="Permanent link">&para;</a></h3>
<p>Now let’s put the insights from the previous section to work.</p>
<p>Imagine that you are <a href="http://yann.lecun.com">Yann LeCun</a> or <a href="https://research.google/people/author121/">Corinna Cortes</a>, the creators of the MNIST dataset, and you have just invested the time to annotate the test split of the dataset by hand. Now, you have collected an additional 60K images of unlabeled digits that you want to use as a training split that you need to annotate.</p>
<p>Let’s see how <a href="https://voxel51.com/docs/fiftyone/api/fiftyone.brain.html#fiftyone.brain.compute_visualization">compute_visualization()</a> can be used to efficiently pre-annotate the train split with minimal effort.</p>
<p>First, let’s regenerate embeddings for all 70,000 images in the combined test and train splits:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-27-1"><span class="p">[</span><span class="mi">8</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-28-1"><span class="c1"># Construct a ``num_samples x num_pixels`` array of images</span>
</span><span id="__span-28-2"><span class="n">embeddings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>\
</span><span id="__span-28-3">    <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_UNCHANGED</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>\
</span><span id="__span-28-4">    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s2">&quot;filepath&quot;</span><span class="p">)</span>\
</span><span id="__span-28-5"><span class="p">])</span>
</span><span id="__span-28-6">
</span><span id="__span-28-7"><span class="c1"># Compute 2D representation</span>
</span><span id="__span-28-8"><span class="n">results</span> <span class="o">=</span> <span class="n">fob</span><span class="o">.</span><span class="n">compute_visualization</span><span class="p">(</span>
</span><span id="__span-28-9">    <span class="n">dataset</span><span class="p">,</span>
</span><span id="__span-28-10">    <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
</span><span id="__span-28-11">    <span class="n">num_dims</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-28-12">    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;umap&quot;</span><span class="p">,</span>
</span><span id="__span-28-13">    <span class="n">brain_key</span><span class="o">=</span><span class="s2">&quot;mnist&quot;</span><span class="p">,</span>
</span><span id="__span-28-14">    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-28-15">    <span class="n">seed</span><span class="o">=</span><span class="mi">51</span><span class="p">,</span>
</span><span id="__span-28-16"><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-29-1"><span class="n">Generating</span> <span class="n">visualization</span><span class="o">...</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-30-1"><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">Caskroom</span><span class="o">/</span><span class="n">miniforge</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">fo</span><span class="o">-</span><span class="n">dev</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.9</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">numba</span><span class="o">/</span><span class="n">cpython</span><span class="o">/</span><span class="n">hashing</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">482</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="n">FNV</span> <span class="n">hashing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">implemented</span> <span class="ow">in</span> <span class="n">Numba</span><span class="o">.</span> <span class="n">See</span> <span class="n">PEP</span> <span class="mi">456</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">python</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">peps</span><span class="o">/</span><span class="n">pep</span><span class="o">-</span><span class="mi">0456</span><span class="o">/</span> <span class="k">for</span> <span class="n">rationale</span> <span class="n">over</span> <span class="ow">not</span> <span class="n">using</span> <span class="n">FNV</span><span class="o">.</span> <span class="n">Numba</span> <span class="n">will</span> <span class="k">continue</span> <span class="n">to</span> <span class="n">work</span><span class="p">,</span> <span class="n">but</span> <span class="n">hashes</span> <span class="k">for</span> <span class="n">built</span> <span class="ow">in</span> <span class="n">types</span> <span class="n">will</span> <span class="n">be</span> <span class="n">computed</span> <span class="n">using</span> <span class="n">siphash24</span><span class="o">.</span> <span class="n">This</span> <span class="n">will</span> <span class="n">permit</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">dictionaries</span> <span class="n">to</span> <span class="k">continue</span> <span class="n">to</span> <span class="n">behave</span> <span class="k">as</span> <span class="n">expected</span><span class="p">,</span> <span class="n">however</span> <span class="n">anything</span> <span class="n">relying</span> <span class="n">on</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="n">the</span> <span class="nb">hash</span> <span class="n">opposed</span> <span class="n">to</span> <span class="nb">hash</span> <span class="k">as</span> <span class="n">a</span> <span class="n">derived</span> <span class="nb">property</span> <span class="ow">is</span> <span class="n">likely</span> <span class="n">to</span> <span class="ow">not</span> <span class="n">work</span> <span class="k">as</span> <span class="n">expected</span><span class="o">.</span>
</span><span id="__span-30-2">  <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="__span-30-3"><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">Caskroom</span><span class="o">/</span><span class="n">miniforge</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">fo</span><span class="o">-</span><span class="n">dev</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.9</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">umap</span><span class="o">/</span><span class="n">umap_</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1943</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="n">n_jobs</span> <span class="n">value</span> <span class="o">-</span><span class="mi">1</span> <span class="n">overridden</span> <span class="n">to</span> <span class="mi">1</span> <span class="n">by</span> <span class="n">setting</span> <span class="n">random_state</span><span class="o">.</span> <span class="n">Use</span> <span class="n">no</span> <span class="n">seed</span> <span class="k">for</span> <span class="n">parallelism</span><span class="o">.</span>
</span><span id="__span-30-4">  <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n_jobs value </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_jobs</span><span class="si">}</span><span class="s2"> overridden to 1 by setting random_state. Use no seed for parallelism.&quot;</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-31-1"><span class="n">UMAP</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">51</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-31-2"><span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">27</span> <span class="mi">11</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">27</span> <span class="mi">2024</span> <span class="n">Construct</span> <span class="n">fuzzy</span> <span class="n">simplicial</span> <span class="nb">set</span>
</span><span id="__span-31-3"><span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">27</span> <span class="mi">11</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">27</span> <span class="mi">2024</span> <span class="n">Finding</span> <span class="n">Nearest</span> <span class="n">Neighbors</span>
</span><span id="__span-31-4"><span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">27</span> <span class="mi">11</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">27</span> <span class="mi">2024</span> <span class="n">Building</span> <span class="n">RP</span> <span class="n">forest</span> <span class="k">with</span> <span class="mi">18</span> <span class="n">trees</span>
</span><span id="__span-31-5"><span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">27</span> <span class="mi">11</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">30</span> <span class="mi">2024</span> <span class="n">NN</span> <span class="n">descent</span> <span class="k">for</span> <span class="mi">16</span> <span class="n">iterations</span>
</span><span id="__span-31-6">         <span class="mi">1</span>  <span class="o">/</span>  <span class="mi">16</span>
</span><span id="__span-31-7">         <span class="mi">2</span>  <span class="o">/</span>  <span class="mi">16</span>
</span><span id="__span-31-8">         <span class="mi">3</span>  <span class="o">/</span>  <span class="mi">16</span>
</span><span id="__span-31-9">         <span class="mi">4</span>  <span class="o">/</span>  <span class="mi">16</span>
</span><span id="__span-31-10">        <span class="n">Stopping</span> <span class="n">threshold</span> <span class="n">met</span> <span class="o">--</span> <span class="n">exiting</span> <span class="n">after</span> <span class="mi">4</span> <span class="n">iterations</span>
</span><span id="__span-31-11"><span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">27</span> <span class="mi">11</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">38</span> <span class="mi">2024</span> <span class="n">Finished</span> <span class="n">Nearest</span> <span class="n">Neighbor</span> <span class="n">Search</span>
</span><span id="__span-31-12"><span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">27</span> <span class="mi">11</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">40</span> <span class="mi">2024</span> <span class="n">Construct</span> <span class="n">embedding</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-32-1">        <span class="n">completed</span>  <span class="mi">0</span>  <span class="o">/</span>  <span class="mi">200</span> <span class="n">epochs</span>
</span><span id="__span-32-2">        <span class="n">completed</span>  <span class="mi">20</span>  <span class="o">/</span>  <span class="mi">200</span> <span class="n">epochs</span>
</span><span id="__span-32-3">        <span class="n">completed</span>  <span class="mi">40</span>  <span class="o">/</span>  <span class="mi">200</span> <span class="n">epochs</span>
</span><span id="__span-32-4">        <span class="n">completed</span>  <span class="mi">60</span>  <span class="o">/</span>  <span class="mi">200</span> <span class="n">epochs</span>
</span><span id="__span-32-5">        <span class="n">completed</span>  <span class="mi">80</span>  <span class="o">/</span>  <span class="mi">200</span> <span class="n">epochs</span>
</span><span id="__span-32-6">        <span class="n">completed</span>  <span class="mi">100</span>  <span class="o">/</span>  <span class="mi">200</span> <span class="n">epochs</span>
</span><span id="__span-32-7">        <span class="n">completed</span>  <span class="mi">120</span>  <span class="o">/</span>  <span class="mi">200</span> <span class="n">epochs</span>
</span><span id="__span-32-8">        <span class="n">completed</span>  <span class="mi">140</span>  <span class="o">/</span>  <span class="mi">200</span> <span class="n">epochs</span>
</span><span id="__span-32-9">        <span class="n">completed</span>  <span class="mi">160</span>  <span class="o">/</span>  <span class="mi">200</span> <span class="n">epochs</span>
</span><span id="__span-32-10">        <span class="n">completed</span>  <span class="mi">180</span>  <span class="o">/</span>  <span class="mi">200</span> <span class="n">epochs</span>
</span><span id="__span-32-11"><span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">27</span> <span class="mi">11</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">12</span> <span class="mi">2024</span> <span class="n">Finished</span> <span class="n">embedding</span>
</span></code></pre></div>
<p>Of course, our dataset already has ground truth labels for the train split, but let’s pretend that’s not the case and generate an array of <code>labels</code> for our visualization that colors the test split by its ground truth labels and marks all images in the train split as <code>unlabeled</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-33-1"><span class="p">[</span><span class="mi">9</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-34-1"><span class="kn">from</span><span class="w"> </span><span class="nn">fiftyone</span><span class="w"> </span><span class="kn">import</span> <span class="n">ViewField</span> <span class="k">as</span> <span class="n">F</span>
</span><span id="__span-34-2">
</span><span id="__span-34-3"><span class="c1"># Label `test` split samples by their ground truth label</span>
</span><span id="__span-34-4"><span class="c1"># Mark all samples in `train` split as `unlabeled`</span>
</span><span id="__span-34-5"><span class="n">expr</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="s2">&quot;$tags&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">if_else</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">),</span> <span class="s2">&quot;unlabeled&quot;</span><span class="p">)</span>
</span><span id="__span-34-6"><span class="n">labels</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s2">&quot;ground_truth&quot;</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="n">expr</span><span class="p">)</span>
</span><span id="__span-34-7"><span class="c1"># Set the `ground_truth.label` field to the computed labels</span>
</span><span id="__span-34-8"><span class="n">dataset</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="s2">&quot;ground_truth.label&quot;</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-35-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-36-1"><span class="c1"># Launch a new App instance</span>
</span><span id="__span-36-2"><span class="n">session</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">launch_app</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></code></pre></div>
<p><img alt="Unlabeled Images" src="../../_images/image_embeddings_unlabeled.png" /></p>
<p>What’s so great about this plot? Notice that the unlabeled points in our (to-be-labeled) train split are heavily clustered into the same clusters as the labeled points from the test split!</p>
<p>Follow the simple workflow below to use FiftyOne’s <a href="https://voxel51.com/docs/fiftyone/user_guide/app.html#tags-and-tagging">in-App tagging feature</a> to efficiently assign proposed labels for all samples in the <code>train</code> split: 1. Click on the <code>unlabeled</code> trace to hide it, and then use the predominant color of the labeled points in the cluster below to determine the identity of the cluster 2. Now double-click on the <code>unlabeled</code> trace so that <em>only</em> the unlabeled points are visible in the
plot 3. Use the <code>Lasso Select</code> tool to select the <code>unlabeled</code> points in the cluster whose identity you just deduced 4. Over in the App, click on the <code>tag</code> icon and assign a tag to the samples 5. Repeat steps 1-4 for the other clusters</p>
<p>Congratulations, you just pre-annotated ~60,000 training images!</p>
<p><img alt="pre-annotation" src="../../_images/image_embeddings_prelabel.gif" /></p>
<p>You can easily print some statistics about the sample tags that you created:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-37-1"><span class="p">[</span><span class="mi">12</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-38-1"><span class="c1"># The train split that we pre-annotated</span>
</span><span id="__span-38-2"><span class="n">train_split</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">match_tags</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
</span><span id="__span-38-3">
</span><span id="__span-38-4"><span class="c1"># Print state about labels that were added</span>
</span><span id="__span-38-5"><span class="nb">print</span><span class="p">(</span><span class="n">train_split</span><span class="o">.</span><span class="n">count_sample_tags</span><span class="p">())</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-39-1"><span class="p">{</span><span class="s1">&#39;8&#39;</span><span class="p">:</span> <span class="mi">5577</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">:</span> <span class="mi">6006</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span> <span class="mi">6104</span><span class="p">,</span> <span class="s1">&#39;7&#39;</span><span class="p">:</span> <span class="mi">6361</span><span class="p">,</span> <span class="s1">&#39;9&#39;</span><span class="p">:</span> <span class="mi">6036</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span> <span class="mi">5389</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">:</span> <span class="mi">60000</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span> <span class="mi">5981</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span> <span class="mi">5737</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="mi">5811</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="mi">6937</span><span class="p">}</span>
</span></code></pre></div>
<p>The snippet below converts the sample tags into <a href="https://voxel51.com/docs/fiftyone/user_guide/using_datasets.html#classification">Classification labels</a> in a new <code>hypothesis</code> field of the dataset:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-40-1"><span class="p">[</span><span class="mi">21</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-41-1"><span class="c1"># Add a new Classification field called `hypothesis` to store our guesses</span>
</span><span id="__span-41-2"><span class="k">with</span> <span class="n">fo</span><span class="o">.</span><span class="n">ProgressBar</span><span class="p">()</span> <span class="k">as</span> <span class="n">pb</span><span class="p">:</span>
</span><span id="__span-41-3">    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">pb</span><span class="p">(</span><span class="n">train_split</span><span class="p">):</span>
</span><span id="__span-41-4">        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">sample</span><span class="o">.</span><span class="n">tags</span> <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="s2">&quot;train&quot;</span><span class="p">]</span>
</span><span id="__span-41-5">        <span class="k">if</span> <span class="n">labels</span><span class="p">:</span>
</span><span id="__span-41-6">            <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;hypothesis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">Classification</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-41-7">            <span class="n">sample</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="__span-41-8">
</span><span id="__span-41-9"><span class="c1"># Print stats about the labels we created</span>
</span><span id="__span-41-10"><span class="nb">print</span><span class="p">(</span><span class="n">train_split</span><span class="o">.</span><span class="n">count_values</span><span class="p">(</span><span class="s2">&quot;hypothesis.label&quot;</span><span class="p">))</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-42-1"> <span class="mi">100</span><span class="o">%</span> <span class="o">|</span><span class="err">█████████████</span><span class="o">|</span> <span class="mi">60000</span><span class="o">/</span><span class="mi">60000</span> <span class="p">[</span><span class="mf">2.6</span><span class="n">m</span> <span class="n">elapsed</span><span class="p">,</span> <span class="mi">0</span><span class="n">s</span> <span class="n">remaining</span><span class="p">,</span> <span class="mf">353.0</span> <span class="n">samples</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
</span><span id="__span-42-2"><span class="p">{</span><span class="s1">&#39;0&#39;</span><span class="p">:</span> <span class="mi">5981</span><span class="p">,</span> <span class="s1">&#39;9&#39;</span><span class="p">:</span> <span class="mi">6036</span><span class="p">,</span> <span class="s1">&#39;8&#39;</span><span class="p">:</span> <span class="mi">5572</span><span class="p">,</span> <span class="s1">&#39;7&#39;</span><span class="p">:</span> <span class="mi">6361</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">:</span> <span class="mi">6006</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span> <span class="mi">5388</span><span class="p">,</span> <span class="kc">None</span><span class="p">:</span> <span class="mi">69</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span> <span class="mi">6104</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="mi">6937</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span> <span class="mi">5735</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="mi">5811</span><span class="p">}</span>
</span></code></pre></div>
<p>In the example above, notice that 69 samples in the train split were not given a hypothesis (i.e., they were not included in the cluster-based tagging procedure). If you would like to retrieve them and manually assign tags, that is easy:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-43-1"><span class="p">[</span><span class="mi">23</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-44-1"><span class="n">no_hypothesis</span> <span class="o">=</span> <span class="n">train_split</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;hypothesis.label&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="__span-44-2"><span class="nb">print</span><span class="p">(</span><span class="n">no_hypothesis</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-45-1"><span class="n">Dataset</span><span class="p">:</span>        <span class="n">mnist</span>
</span><span id="__span-45-2"><span class="n">Media</span> <span class="nb">type</span><span class="p">:</span>     <span class="n">image</span>
</span><span id="__span-45-3"><span class="n">Num</span> <span class="n">samples</span><span class="p">:</span>    <span class="mi">69</span>
</span><span id="__span-45-4"><span class="n">Tags</span><span class="p">:</span>           <span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span>
</span><span id="__span-45-5"><span class="n">Sample</span> <span class="n">fields</span><span class="p">:</span>
</span><span id="__span-45-6">    <span class="n">filepath</span><span class="p">:</span>     <span class="n">fiftyone</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">StringField</span>
</span><span id="__span-45-7">    <span class="n">tags</span><span class="p">:</span>         <span class="n">fiftyone</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">ListField</span><span class="p">(</span><span class="n">fiftyone</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">StringField</span><span class="p">)</span>
</span><span id="__span-45-8">    <span class="n">metadata</span><span class="p">:</span>     <span class="n">fiftyone</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">EmbeddedDocumentField</span><span class="p">(</span><span class="n">fiftyone</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">Metadata</span><span class="p">)</span>
</span><span id="__span-45-9">    <span class="n">ground_truth</span><span class="p">:</span> <span class="n">fiftyone</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">EmbeddedDocumentField</span><span class="p">(</span><span class="n">fiftyone</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">Classification</span><span class="p">)</span>
</span><span id="__span-45-10">    <span class="n">hypothesis</span><span class="p">:</span>   <span class="n">fiftyone</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">EmbeddedDocumentField</span><span class="p">(</span><span class="n">fiftyone</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">Classification</span><span class="p">)</span>
</span><span id="__span-45-11"><span class="n">View</span> <span class="n">stages</span><span class="p">:</span>
</span><span id="__span-45-12">    <span class="mf">1.</span> <span class="n">MatchTags</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">])</span>
</span><span id="__span-45-13">    <span class="mf">2.</span> <span class="n">Exists</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="s1">&#39;hypothesis.label&#39;</span><span class="p">,</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></code></pre></div>
<p>Depending on your application, you may be able to start training using the <code>hypothesis</code> labels directly by <a href="https://voxel51.com/docs/fiftyone/user_guide/export_datasets.html">exporting the dataset</a> as, say, a classification directory tree structure:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-46-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-47-1"><span class="c1"># Export `hypothesis` labels as a classification directory tree format</span>
</span><span id="__span-47-2"><span class="c1"># `exists()` ensures that we only export samples with a hypothesis</span>
</span><span id="__span-47-3"><span class="n">train_split</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;hypothesis.label&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
</span><span id="__span-47-4">    <span class="n">export_dir</span><span class="o">=</span><span class="s2">&quot;/path/for/dataset&quot;</span><span class="p">,</span>
</span><span id="__span-47-5">    <span class="n">dataset_type</span><span class="o">=</span><span class="n">fo</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">ImageClassificationDirectoryTree</span><span class="p">,</span>
</span><span id="__span-47-6">    <span class="n">label_field</span><span class="o">=</span><span class="s2">&quot;hypothesis&quot;</span><span class="p">,</span>
</span><span id="__span-47-7"><span class="p">)</span>
</span></code></pre></div>
<p>Or perhaps you’ll want to export the hypothesized labels to your annotation provider to fine-tune the labels for training.</p>
<p>FiftyOne provides integrations for importing/exporting data to <a href="https://voxel51.com/docs/fiftyone/api/fiftyone.utils.scale.html">Scale</a>, <a href="https://voxel51.com/docs/fiftyone/api/fiftyone.utils.labelbox.html">Labelbox</a>, <a href="https://docs.voxel51.com/integrations/labelstudio.html">Label Studio</a>, <a href="https://docs.voxel51.com/integrations/v7.html">V7</a>, and <a href="https://voxel51.com/docs/fiftyone/user_guide/export_datasets.html#cvatimagedataset">CVAT</a>. Check out <a href="https://towardsdatascience.com/managing-annotation-mistakes-with-fiftyone-and-labelbox-fc6e87b51102">this blog\
post</a> for more information about FiftyOne’s Labelbox integration.</p>
<h3 id="loading-existing-visualizations">Loading existing visualizations <a href="#Loading-existing-visualizations" title="Permalink to this headline">¶</a><a class="headerlink" href="#loading-existing-visualizations" title="Permanent link">&para;</a></h3>
<p>If you provide the <code>brain_key</code> argument to <a href="https://voxel51.com/docs/fiftyone/api/fiftyone.brain.html#fiftyone.brain.compute_visualization">compute_visualization()</a>, then the visualization results that you generate will be saved and you can recall them later.</p>
<p>For example, we can recall the visualization results that we first computed on the test split:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-48-1"><span class="p">[</span><span class="mi">60</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-49-1"><span class="c1"># List brain runs saved on the dataset</span>
</span><span id="__span-49-2"><span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">list_brain_runs</span><span class="p">())</span>
</span><span id="__span-49-3">
</span><span id="__span-49-4"><span class="c1"># Load the results for a brain run</span>
</span><span id="__span-49-5"><span class="n">results</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">load_brain_results</span><span class="p">(</span><span class="s2">&quot;mnist_test&quot;</span><span class="p">)</span>
</span><span id="__span-49-6"><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</span><span id="__span-49-7">
</span><span id="__span-49-8"><span class="c1"># Load the dataset view on which the results were computed</span>
</span><span id="__span-49-9"><span class="n">results_view</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">load_brain_view</span><span class="p">(</span><span class="s2">&quot;mnist_test&quot;</span><span class="p">)</span>
</span><span id="__span-49-10"><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results_view</span><span class="p">))</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-50-1"><span class="p">[</span><span class="s1">&#39;mnist&#39;</span><span class="p">,</span> <span class="s1">&#39;mnist_test&#39;</span><span class="p">]</span>
</span><span id="__span-50-2"><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="err">&#39;</span><span class="nc">fiftyone</span><span class="o">.</span><span class="n">brain</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">VisualizationResults</span><span class="s1">&#39;&gt;</span>
</span><span id="__span-50-3"><span class="mi">10000</span>
</span></code></pre></div>
<p>See <a href="https://voxel51.com/docs/fiftyone/user_guide/brain.html#managing-brain-runs">this docs page</a> for more information about managing brain runs.</p>
<h2 id="part-ii-bdd100k">Part II: BDD100K <a href="#Part-II:-BDD100K" title="Permalink to this headline">¶</a><a class="headerlink" href="#part-ii-bdd100k" title="Permanent link">&para;</a></h2>
<p>In this section, we’ll visualize embeddings from a deep model on the <a href="https://voxel51.com/docs/fiftyone/user_guide/dataset_zoo/datasets.html?highlight=bdd100k#dataset-zoo-bdd100k">BDD100K dataset</a> from the FiftyOne Dataset Zoo and demonstrate some of the insights that you can glean from them.</p>
<p>If you want to follow along youself, you will need to register at <a href="https://bdd-data.berkeley.edu">https://bdd-data.berkeley.edu</a> in order to get links to download the data. See the <a href="https://voxel51.com/docs/fiftyone/user_guide/dataset_zoo/datasets.html?highlight=bdd100k#dataset-zoo-bdd100k">zoo docs</a> for details on loading the dataset.</p>
<p>We’ll be working with the validation split, which contains 10,000 labeled images:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-51-1"><span class="p">[</span><span class="mi">25</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-52-1"><span class="kn">import</span><span class="w"> </span><span class="nn">fiftyone</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">fo</span>
</span><span id="__span-52-2"><span class="kn">import</span><span class="w"> </span><span class="nn">fiftyone.zoo</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">foz</span>
</span><span id="__span-52-3">
</span><span id="__span-52-4"><span class="c1"># The path to the source files that you manually downloaded</span>
</span><span id="__span-52-5"><span class="n">source_dir</span> <span class="o">=</span> <span class="s2">&quot;/path/to/dir-with-bdd100k-files&quot;</span>
</span><span id="__span-52-6">
</span><span id="__span-52-7"><span class="n">dataset</span> <span class="o">=</span> <span class="n">foz</span><span class="o">.</span><span class="n">load_zoo_dataset</span><span class="p">(</span><span class="s2">&quot;bdd100k&quot;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;validation&quot;</span><span class="p">,</span> <span class="n">source_dir</span><span class="o">=</span><span class="n">source_dir</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-53-1"><span class="n">Split</span> <span class="s1">&#39;validation&#39;</span> <span class="n">already</span> <span class="n">prepared</span>
</span><span id="__span-53-2"><span class="n">Loading</span> <span class="n">existing</span> <span class="n">dataset</span> <span class="s1">&#39;bdd100k-validation&#39;</span><span class="o">.</span> <span class="n">To</span> <span class="n">reload</span> <span class="kn">from</span><span class="w"> </span><span class="nn">disk</span><span class="p">,</span> <span class="n">either</span> <span class="n">delete</span> <span class="n">the</span> <span class="n">existing</span> <span class="n">dataset</span> <span class="ow">or</span> <span class="n">provide</span> <span class="n">a</span> <span class="n">custom</span> <span class="err">`</span><span class="n">dataset_name</span><span class="err">`</span> <span class="n">to</span> <span class="n">use</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-54-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-55-1"><span class="n">session</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">launch_app</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</span></code></pre></div>
<p><img alt="BDD100K validation split" src="../../_images/image_embeddings_bdd100k.png" /></p>
<h3 id="computing-image-embeddings_1">Computing image embeddings <a href="#id1" title="Permalink to this headline">¶</a><a class="headerlink" href="#computing-image-embeddings_1" title="Permanent link">&para;</a></h3>
<p>The BDD100K images are 1280 x 720 pixels, so we’ll use a deep model to generate intermediate embeddings.</p>
<p>Using a deep model not only enables us to visualize larger datasets or ones with different image sizes, it also enables us to key in on different features of the dataset, depending on the model that we use to generate embeddings. By default, <a href="https://voxel51.com/docs/fiftyone/api/fiftyone.brain.html#fiftyone.brain.compute_visualization">compute_visualization()</a> will generate embeddings using a general-purpose model that works well for datasets of any kind.</p>
<p>You can run the cell below to generate a 2D representation for the BDD100K validation split using FiftyOne’s default model. You will likely want to run this on a machine with GPU, as this requires running inference on 10,000 images:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-56-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-57-1"><span class="kn">import</span><span class="w"> </span><span class="nn">fiftyone.brain</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">fob</span>
</span><span id="__span-57-2">
</span><span id="__span-57-3"><span class="c1"># Compute 2D representation</span>
</span><span id="__span-57-4"><span class="c1"># This will compute deep embeddings for all 10,000 images</span>
</span><span id="__span-57-5"><span class="n">results</span> <span class="o">=</span> <span class="n">fob</span><span class="o">.</span><span class="n">compute_visualization</span><span class="p">(</span>
</span><span id="__span-57-6">    <span class="n">dataset</span><span class="p">,</span>
</span><span id="__span-57-7">    <span class="n">num_dims</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-57-8">    <span class="n">brain_key</span><span class="o">=</span><span class="s2">&quot;img_viz&quot;</span><span class="p">,</span>
</span><span id="__span-57-9">    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-57-10">    <span class="n">seed</span><span class="o">=</span><span class="mi">51</span><span class="p">,</span>
</span><span id="__span-57-11"><span class="p">)</span>
</span></code></pre></div>
<p>Alternatively, you can provide your own custom embeddings via the <code>embeddings</code> parameter of <a href="https://voxel51.com/docs/fiftyone/api/fiftyone.brain.html#fiftyone.brain.compute_visualization">compute_visualization()</a>. The <a href="https://voxel51.com/docs/fiftyone/user_guide/model_zoo/index.html">FiftyOne Model Zoo</a> provides dozens of models that expose embeddings that you can use for this purpose.</p>
<p>For example, the cell below generates a visualization using pre-computed embeddings from a ResNet model from the zoo:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-58-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-59-1"><span class="c1"># Load a resnet from the model zoo</span>
</span><span id="__span-59-2"><span class="n">model</span> <span class="o">=</span> <span class="n">foz</span><span class="o">.</span><span class="n">load_zoo_model</span><span class="p">(</span><span class="s2">&quot;resnet50-imagenet-torch&quot;</span><span class="p">)</span>
</span><span id="__span-59-3">
</span><span id="__span-59-4"><span class="c1"># Verify that the model exposes embeddings</span>
</span><span id="__span-59-5"><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">has_embeddings</span><span class="p">)</span>
</span><span id="__span-59-6"><span class="c1"># True</span>
</span><span id="__span-59-7">
</span><span id="__span-59-8"><span class="c1"># Compute embeddings for each image</span>
</span><span id="__span-59-9"><span class="n">embeddings</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">compute_embeddings</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="__span-59-10"><span class="nb">print</span><span class="p">(</span><span class="n">embeddings</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="__span-59-11"><span class="c1"># 10000 x 2048</span>
</span><span id="__span-59-12">
</span><span id="__span-59-13"><span class="c1"># Compute 2D representation using pre-computed embeddings</span>
</span><span id="__span-59-14"><span class="n">results</span> <span class="o">=</span> <span class="n">fob</span><span class="o">.</span><span class="n">compute_visualization</span><span class="p">(</span>
</span><span id="__span-59-15">    <span class="n">dataset</span><span class="p">,</span>
</span><span id="__span-59-16">    <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
</span><span id="__span-59-17">    <span class="n">num_dims</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-59-18">    <span class="n">brain_key</span><span class="o">=</span><span class="s2">&quot;image_embeddings&quot;</span><span class="p">,</span>
</span><span id="__span-59-19">    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-59-20">    <span class="n">seed</span><span class="o">=</span><span class="mi">51</span><span class="p">,</span>
</span><span id="__span-59-21"><span class="p">)</span>
</span></code></pre></div>
<p>Either way, we’re ready to visualize our representation.</p>
<h3 id="visualizing-embeddings_1">Visualizing embeddings <a href="#id2" title="Permalink to this headline">¶</a><a class="headerlink" href="#visualizing-embeddings_1" title="Permanent link">&para;</a></h3>
<p>As usual, we’ll start by launching an App instance and opening the embeddings panel to interactively explore the results:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-60-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-61-1"><span class="n">session</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">launch_app</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</span></code></pre></div>
<p>The BDD100K dataset contains a handful of image-level labels, including scene type, time of day, and weather.</p>
<p>Let’s use the time of day labels to color our scatterplot:</p>
<p><img alt="BDD100K embeddings" src="../../_images/image_embeddings_bdd100k_colorby.gif" /></p>
<p>Notice that the visualization has a dominant bimodal distribution corresponding to whether the time of day is <code>daytime</code> or <code>night</code>!</p>
<p>You can investigate each cluster in more detail using the <code>Zoom</code> and <code>Pan</code> controls of the plot’s modebar.</p>
<h3 id="investigating-outliers">Investigating outliers <a href="#Investigating-outliers" title="Permalink to this headline">¶</a><a class="headerlink" href="#investigating-outliers" title="Permanent link">&para;</a></h3>
<p>Outlier clusters in these plots often correspond to images with distinctive properties. Let’s <code>Lasso Select</code> some outlier regions to investigate:</p>
<ul>
<li>
<p>The first cluster contains images where the dashboard of the vehicle heavily occludes the view</p>
</li>
<li>
<p>The second cluster contains images in rainy scenes where the windshield has water droplets on it</p>
</li>
<li>
<p>The third cluster contains images where a cell phone is in the field of view</p>
</li>
</ul>
<p><img alt="bdd100k-outliers" src="../../_images/image_embeddings_outliers.gif" /></p>
<h3 id="tagging-label-mistakes">Tagging label mistakes <a href="#Tagging-label-mistakes" title="Permalink to this headline">¶</a><a class="headerlink" href="#tagging-label-mistakes" title="Permanent link">&para;</a></h3>
<p>We can also use the scatterplot to tag samples whose <code>timeofday</code> labels are incorrect by taking the following actions:</p>
<ul>
<li>
<p>Deselect all labels except <code>night</code> in the legend</p>
</li>
<li>
<p>Lasso select the nightime points (yellow) within the daytime cluster (red)</p>
</li>
<li>
<p>Click the tag icon in the upper-left corner of the sample grid in the App</p>
</li>
<li>
<p>Add an appropriate tag to the samples in the current view to mark the mistakes</p>
</li>
</ul>
<p><img alt="bdd100k-mistakes" src="../../_images/image_embeddings_tag_mistakes.gif" /></p>
<h2 id="summary">Summary <a href="#Summary" title="Permalink to this headline">¶</a><a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>In this tutorial, we showed how to use FiftyOne to compute embeddings for image datasets and demonstrated a few of their many uses, including:</p>
<ul>
<li>
<p>Visualizing the hidden structure of image datasets</p>
</li>
<li>
<p>Pre-annotating unlabeled data for training</p>
</li>
<li>
<p>Identifying anomolous/incorrect image labels</p>
</li>
<li>
<p>Finding examples of scenarios of interest</p>
</li>
</ul>
<p><strong>So, what’s the takeaway?</strong></p>
<p>Combing through individual images in a dataset and staring at aggregate performance metrics trying to figure out how to improve the performance of a model is an ineffective and time-consuming process.</p>
<p>Visualizing your dataset in a low-dimensional embedding space is a powerful workflow that can reveal patterns and clusters in your data that can answer important questions about the critical failure modes of your model. It can also help you automate workflows like finding label mistakes and efficiently pre-annotating data.</p>
<p>FiftyOne also supports visualizing embeddings for object detections. Stay tuned for an upcoming tutorial on the topic!</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.path", "navigation.indexes", "navigation.top", {"icon": {"repo": "fontawesome/brands/github"}}, "content.action.edit"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>