
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Detecting Small Objects with SAHI Â¶ - Voxel51 Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#detecting-small-objects-with-sahi" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Voxel51 Documentation" class="md-header__button md-logo" aria-label="Voxel51 Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Voxel51 Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Detecting Small Objects with SAHI Â¶
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/thesteve0/vdoc-mkdocs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Voxel51 Documentation" class="md-nav__button md-logo" aria-label="Voxel51 Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Voxel51 Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/thesteve0/vdoc-mkdocs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/virtualenv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virtualenvs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/datasets_samples_fields/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Datasets, Samples, and Fields
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/application_tour/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tour of the Applications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../fiftyone_concepts/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    FiftyOne Concepts
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            FiftyOne Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fiftyone_concepts/basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../brain/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Machine Learning
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How Do I
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../data_and_models/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Data and Models
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Data and Models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../data_and_models/dataset_zoo/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Zoo Datasets
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Zoo Datasets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_and_models/dataset_zoo/datasets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Built-In Zoo Datasets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_and_models/dataset_zoo/remote/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remotely-Sourced Zoo Datasets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_and_models/dataset_zoo/api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zoo Data API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_and_models/hugging_face_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hugging Face Datasets
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrations
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
          
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../api/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    References
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            References
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLI
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../community/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Community
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../teams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fifty One Teams
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Releases
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup-and-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Setup and Installation Â¶
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#standard-inference-with-yolov8" class="md-nav__link">
    <span class="md-ellipsis">
      Standard Inference with YOLOv8 Â¶
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detecting-small-objects-with-sahi_1" class="md-nav__link">
    <span class="md-ellipsis">
      Detecting Small Objects with SAHI Â¶
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluating-sahi-predictions" class="md-nav__link">
    <span class="md-ellipsis">
      Evaluating SAHI Predictions Â¶
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Evaluating SAHI Predictions Â¶">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-fiftyones-evaluation-api" class="md-nav__link">
    <span class="md-ellipsis">
      Using FiftyOneâ€™s Evaluation API Â¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluating-performance-on-small-objects" class="md-nav__link">
    <span class="md-ellipsis">
      Evaluating Performance on Small Objects Â¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#identifying-edge-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Identifying Edge Cases Â¶
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary Â¶
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Additional Resources Â¶
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/thesteve0/vdoc-mkdocs/blob/main/docs/tutorials/small_object_detection.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="detecting-small-objects-with-sahi">Detecting Small Objects with SAHI <a href="#Detecting-Small-Objects-with-SAHI" title="Permalink to this headline">Â¶</a><a class="headerlink" href="#detecting-small-objects-with-sahi" title="Permanent link">&para;</a></h1>
<p><img alt="Teaser" src="../../_images/small_object_detection.jpg" /></p>
<p>Object detection is one of the fundamental tasks in computer vision, but detecting small objects can be particularly challenging.</p>
<p>In this walkthrough, youâ€™ll learn how to use a technique called <a href="https://ieeexplore.ieee.org/document/9897990">SAHI (Slicing Aided Hyper Inference)</a> in conjunction with state-of-the-art object detection models to improve the detection of small objects. Weâ€™ll apply SAHI with Ultralyticsâ€™ YOLOv8 model to detect small objects in the VisDrone dataset, and then evaluate these predictions to better understand how slicing impacts detection performance.</p>
<p>It covers the following:</p>
<ul>
<li>
<p>Loading the VisDrone dataset from the Hugging Face Hub</p>
</li>
<li>
<p>Applying Ultralyticsâ€™ YOLOv8 model to the dataset</p>
</li>
<li>
<p>Using SAHI to run inference on slices of the images</p>
</li>
<li>
<p>Evaluating model performance with and without SAHI</p>
</li>
</ul>
<h2 id="setup-and-installation">Setup and Installation <a href="#Setup-and-Installation" title="Permalink to this headline">Â¶</a><a class="headerlink" href="#setup-and-installation" title="Permanent link">&para;</a></h2>
<p>For this walkthrough, weâ€™ll be using the following libraries:</p>
<ul>
<li>
<p><code>fiftyone</code> for dataset exploration and manipulation</p>
</li>
<li>
<p><code>huggingface_hub</code> for loading the VisDrone dataset</p>
</li>
<li>
<p><code>ultralytics</code> for running object detection with YOLOv8</p>
</li>
<li>
<p><code>sahi</code> for slicing aided hyper inference</p>
</li>
</ul>
<p>If you havenâ€™t already, install the latest versions of these libraries:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><span class="p">[</span><span class="mi">62</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">U</span> <span class="n">fiftyone</span> <span class="n">sahi</span> <span class="n">ultralytics</span> <span class="n">huggingface_hub</span> <span class="o">--</span><span class="n">quiet</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><span class="n">Note</span><span class="p">:</span> <span class="n">you</span> <span class="n">may</span> <span class="n">need</span> <span class="n">to</span> <span class="n">restart</span> <span class="n">the</span> <span class="n">kernel</span> <span class="n">to</span> <span class="n">use</span> <span class="n">updated</span> <span class="n">packages</span><span class="o">.</span>
</span></code></pre></div>
<p>Letâ€™s get started! ðŸš€</p>
<p>First, import the necessary modules from FiftyOne:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><span class="kn">import</span><span class="w"> </span><span class="nn">fiftyone</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">fo</span>
</span><span id="__span-4-2"><span class="kn">import</span><span class="w"> </span><span class="nn">fiftyone.zoo</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">foz</span>
</span><span id="__span-4-3"><span class="kn">import</span><span class="w"> </span><span class="nn">fiftyone.utils.huggingface</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">fouh</span>
</span><span id="__span-4-4"><span class="kn">from</span><span class="w"> </span><span class="nn">fiftyone</span><span class="w"> </span><span class="kn">import</span> <span class="n">ViewField</span> <span class="k">as</span> <span class="n">F</span>
</span></code></pre></div>
<p>Now, letâ€™s download some data. Weâ€™ll be taking advantage of FiftyOneâ€™s <a href="https://docs.voxel51.com/integrations/huggingface.html#huggingface-hub">Hugging Face Hub integration</a> to load a subset of the <a href="https://github.com/VisDrone/VisDrone-Dataset">VisDrone dataset</a> directly from the <a href="https://huggingface.co/docs/hub/en/index">Hugging Face Hub</a>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><span class="p">[</span><span class="mi">17</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><span class="n">dataset</span> <span class="o">=</span> <span class="n">fouh</span><span class="o">.</span><span class="n">load_from_hub</span><span class="p">(</span><span class="s2">&quot;Voxel51/VisDrone2019-DET&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;sahi-test&quot;</span><span class="p">,</span> <span class="n">max_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><span class="n">Downloading</span> <span class="n">config</span> <span class="n">file</span> <span class="n">fiftyone</span><span class="o">.</span><span class="n">yml</span> <span class="kn">from</span><span class="w"> </span><span class="nn">Voxel51</span><span class="o">/</span><span class="n">VisDrone2019</span><span class="o">-</span><span class="n">DET</span>
</span><span id="__span-7-2"><span class="n">Loading</span> <span class="n">dataset</span>
</span><span id="__span-7-3"><span class="n">Importing</span> <span class="n">samples</span><span class="o">...</span>
</span><span id="__span-7-4"> <span class="mi">100</span><span class="o">%</span> <span class="o">|</span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><span class="o">|</span> <span class="mi">100</span><span class="o">/</span><span class="mi">100</span> <span class="p">[</span><span class="mf">33.1</span><span class="n">ms</span> <span class="n">elapsed</span><span class="p">,</span> <span class="mi">0</span><span class="n">s</span> <span class="n">remaining</span><span class="p">,</span> <span class="mf">3.0</span><span class="n">K</span> <span class="n">samples</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
</span></code></pre></div>
<p>Before adding any predictions, letâ€™s take a look at the dataset:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><span class="p">[</span><span class="mi">22</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><span class="n">session</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">launch_app</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><span class="n">Session</span> <span class="n">launched</span><span class="o">.</span> <span class="n">Run</span> <span class="err">`</span><span class="n">session</span><span class="o">.</span><span class="n">show</span><span class="p">()</span><span class="err">`</span> <span class="n">to</span> <span class="nb">open</span> <span class="n">the</span> <span class="n">App</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">cell</span> <span class="n">output</span><span class="o">.</span>
</span></code></pre></div>
<p><img alt="VisDrone" src="../../_images/sahi_dataset.jpg" /></p>
<h2 id="standard-inference-with-yolov8">Standard Inference with YOLOv8 <a href="#Standard-Inference-with-YOLOv8" title="Permalink to this headline">Â¶</a><a class="headerlink" href="#standard-inference-with-yolov8" title="Permanent link">&para;</a></h2>
<p>Now that we know what our data looks like, letâ€™s run our standard inference pipeline with a YOLOv8 (large-variant) model. We can load the model from Ultralytics and then apply this directly to our FiftyOne dataset using <code>apply_model()</code>, thanks to <a href="https://docs.voxel51.com/integrations/ultralytics.html">FiftyOneâ€™s Ultralytics integration</a>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><span class="p">[</span><span class="mi">26</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><span class="kn">from</span><span class="w"> </span><span class="nn">ultralytics</span><span class="w"> </span><span class="kn">import</span> <span class="n">YOLO</span>
</span><span id="__span-12-2">
</span><span id="__span-12-3"><span class="n">ckpt_path</span> <span class="o">=</span> <span class="s2">&quot;yolov8l.pt&quot;</span>
</span><span id="__span-12-4"><span class="n">model</span> <span class="o">=</span> <span class="n">YOLO</span><span class="p">(</span><span class="n">ckpt_path</span><span class="p">)</span>
</span><span id="__span-12-5"><span class="c1">## fiftyone will work directly with the Ultralytics.YOLO model</span>
</span><span id="__span-12-6">
</span><span id="__span-12-7"><span class="n">dataset</span><span class="o">.</span><span class="n">apply_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">label_field</span><span class="o">=</span><span class="s2">&quot;base_model&quot;</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"> <span class="mi">100</span><span class="o">%</span> <span class="o">|</span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><span class="o">|</span> <span class="mi">100</span><span class="o">/</span><span class="mi">100</span> <span class="p">[</span><span class="mf">25.0</span><span class="n">s</span> <span class="n">elapsed</span><span class="p">,</span> <span class="mi">0</span><span class="n">s</span> <span class="n">remaining</span><span class="p">,</span> <span class="mf">4.0</span> <span class="n">samples</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
</span></code></pre></div>
<p>Alternatively, if we want FiftyOne to handle the model downloading and location management for us, we can load the same model directly from the <a href="https://docs.voxel51.com/user_guide/model_zoo/index.html">FiftyOne Model Zoo</a>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><span class="c1">## comment this out if you want to use the model from the zoo</span>
</span><span id="__span-15-2"><span class="c1"># model = foz.load_zoo_model(&quot;yolov8l-coco-torch&quot;)</span>
</span><span id="__span-15-3"><span class="c1"># ckpt_path = model.config.model_path</span>
</span><span id="__span-15-4"><span class="c1"># dataset.apply_model(model, label_field=&quot;base_model&quot;)</span>
</span></code></pre></div>
<p>Now that we have predictions, we can visualize them in the App:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><span class="n">session</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">launch_app</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</span></code></pre></div>
<p><img alt="Base Model Predictions" src="../../_images/sahi_base_model.gif" /></p>
<p>Looking at the modelâ€™s predictions next to the ground truth, we can see a few things.</p>
<p>First and foremost, the classes detected by our <em>YOLOv8l</em> model are different from the ground truth classes in the VisDrone dataset. Our YOLO model was trained on the <a href="https://docs.voxel51.com/user_guide/dataset_zoo/datasets.html#coco-2017">COCO dataset</a>, which has 80 classes, while the VisDrone dataset has 12 classes, including an <code>ignore_regions</code> class. To simplify the comparison, weâ€™ll focus on just the few most common classes in the dataset, and will map the VisDrone classes to the COCO
classes as follows:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><span class="p">[</span><span class="mi">6</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pedestrians&quot;</span><span class="p">:</span> <span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="s2">&quot;people&quot;</span><span class="p">:</span> <span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="s2">&quot;van&quot;</span><span class="p">:</span> <span class="s2">&quot;car&quot;</span><span class="p">}</span>
</span><span id="__span-19-2"><span class="n">mapped_view</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">map_labels</span><span class="p">(</span><span class="s2">&quot;ground_truth&quot;</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span>
</span></code></pre></div>
<p>And then filter our labels to only include the classes weâ€™re interested in:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><span class="p">[</span><span class="mi">20</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><span class="k">def</span><span class="w"> </span><span class="nf">get_label_fields</span><span class="p">(</span><span class="n">sample_collection</span><span class="p">):</span>
</span><span id="__span-21-2"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the (detection) label fields of a Dataset or DatasetView.&quot;&quot;&quot;</span>
</span><span id="__span-21-3">    <span class="n">label_fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="__span-21-4">        <span class="n">sample_collection</span><span class="o">.</span><span class="n">get_field_schema</span><span class="p">(</span><span class="n">embedded_doc_type</span><span class="o">=</span><span class="n">fo</span><span class="o">.</span><span class="n">Detections</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="__span-21-5">    <span class="p">)</span>
</span><span id="__span-21-6">    <span class="k">return</span> <span class="n">label_fields</span>
</span><span id="__span-21-7">
</span><span id="__span-21-8"><span class="k">def</span><span class="w"> </span><span class="nf">filter_all_labels</span><span class="p">(</span><span class="n">sample_collection</span><span class="p">):</span>
</span><span id="__span-21-9">    <span class="n">label_fields</span> <span class="o">=</span> <span class="n">get_label_fields</span><span class="p">(</span><span class="n">sample_collection</span><span class="p">)</span>
</span><span id="__span-21-10">
</span><span id="__span-21-11">    <span class="n">filtered_view</span> <span class="o">=</span> <span class="n">sample_collection</span>
</span><span id="__span-21-12">
</span><span id="__span-21-13">    <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="n">label_fields</span><span class="p">:</span>
</span><span id="__span-21-14">        <span class="n">filtered_view</span> <span class="o">=</span> <span class="n">filtered_view</span><span class="o">.</span><span class="n">filter_labels</span><span class="p">(</span>
</span><span id="__span-21-15">            <span class="n">lf</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">is_in</span><span class="p">([</span><span class="s2">&quot;person&quot;</span><span class="p">,</span> <span class="s2">&quot;car&quot;</span><span class="p">,</span> <span class="s2">&quot;truck&quot;</span><span class="p">]),</span> <span class="n">only_matches</span><span class="o">=</span><span class="kc">False</span>
</span><span id="__span-21-16">        <span class="p">)</span>
</span><span id="__span-21-17">    <span class="k">return</span> <span class="n">filtered_view</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><span class="p">[</span><span class="mi">51</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><span class="n">filtered_view</span> <span class="o">=</span> <span class="n">filter_all_labels</span><span class="p">(</span><span class="n">mapped_view</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><span class="p">[</span><span class="mi">52</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><span class="n">session</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">filtered_view</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
</span></code></pre></div>
<p><img alt="Filtered View" src="../../_images/sahi_base_model_predictions_filtered.jpg" /></p>
<p>Now that the classes are aligned and weâ€™ve reduced the crowding in our images, we can see that while the model does a pretty good job of detecting objects, it struggles with the small objects, especially people in the distance. This can happen with large images, as most detection models are trained on fixed-size images. As an example, YOLOv8 is trained on images with maximum side length 640640. When we feed it an image of size 19201920 x 10801080, the model will downsample the image
to 640640 x 360360 before making predictions. This downsampling can cause small objects to be missed, as the model may not have enough information to detect them.</p>
<h2 id="detecting-small-objects-with-sahi_1">Detecting Small Objects with SAHI <a href="#id1" title="Permalink to this headline">Â¶</a><a class="headerlink" href="#detecting-small-objects-with-sahi_1" title="Permanent link">&para;</a></h2>
<p>Theoretically, one could train a model on larger images to improve detection of small objects, but this would require more memory and computational power. Another option is to introduce a sliding window approach, where we split the image into smaller patches, run the model on each patch, and then combine the results. This is the idea behind <a href="https://github.com/obss/sahi">Slicing Aided Hyper Inference</a> (SAHI), which weâ€™ll use to improve the detection of small objects in the VisDrone dataset!</p>
<p><img alt="Alt text" src="https://raw.githubusercontent.com/obss/sahi/main/resources/sliced_inference.gif" /></p>
<p>Illustration of Slicing Aided Hyper Inference. Image courtesy of SAHI Github Repo.</p>
<p>The SAHI technique is implemented in the <code>sahi</code> Python package that we installed earlier. SAHI is a framework which is compatible with many object detection models, including YOLOv8. We can choose the detection model we want to use and create an instance of any of the classes that subclass <code>sahi.models.DetectionModel</code>, including YOLOv8, YOLOv5, and even Hugging Face Transformers models. We will create our model object using SAHIâ€™s <code>AutoDetectionModel</code> class, specifying the model type and
the path to the checkpoint file:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-26-1"><span class="p">[</span><span class="mi">7</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-27-1"><span class="kn">from</span><span class="w"> </span><span class="nn">sahi</span><span class="w"> </span><span class="kn">import</span> <span class="n">AutoDetectionModel</span>
</span><span id="__span-27-2"><span class="kn">from</span><span class="w"> </span><span class="nn">sahi.predict</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_prediction</span><span class="p">,</span> <span class="n">get_sliced_prediction</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-28-1"><span class="p">[</span><span class="mi">11</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-29-1"><span class="n">detection_model</span> <span class="o">=</span> <span class="n">AutoDetectionModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
</span><span id="__span-29-2">    <span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;yolov8&#39;</span><span class="p">,</span>
</span><span id="__span-29-3">    <span class="n">model_path</span><span class="o">=</span><span class="n">ckpt_path</span><span class="p">,</span>
</span><span id="__span-29-4">    <span class="n">confidence_threshold</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="c1">## same as the default value for our base model</span>
</span><span id="__span-29-5">    <span class="n">image_size</span><span class="o">=</span><span class="mi">640</span><span class="p">,</span>
</span><span id="__span-29-6">    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="c1"># or &#39;cuda&#39;</span>
</span><span id="__span-29-7"><span class="p">)</span>
</span></code></pre></div>
<p>Before we generate sliced predictions, letâ€™s inspect the modelâ€™s predictions on a trial image, using SAHIâ€™s <code>get_prediction()</code> function:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-30-1"><span class="p">[</span><span class="mi">60</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-31-1"><span class="n">result</span> <span class="o">=</span> <span class="n">get_prediction</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="n">detection_model</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-31-2"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-32-1"><span class="o">&lt;</span><span class="n">sahi</span><span class="o">.</span><span class="n">prediction</span><span class="o">.</span><span class="n">PredictionResult</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x2b0e9c250</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>Fortunately, SAHI results objects have a <code>to_fiftyone_detections()</code> method, which converts the results to FiftyOne detections:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-33-1"><span class="p">[</span><span class="mi">61</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-34-1"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">to_fiftyone_detections</span><span class="p">())</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-35-1"><span class="p">[</span><span class="o">&lt;</span><span class="n">Detection</span><span class="p">:</span> <span class="p">{</span>\
</span><span id="__span-35-2">    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;661858c20ae3edf77139db7a&#39;</span><span class="p">,</span>\
</span><span id="__span-35-3">    <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="p">{},</span>\
</span><span id="__span-35-4">    <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[],</span>\
</span><span id="__span-35-5">    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;car&#39;</span><span class="p">,</span>\
</span><span id="__span-35-6">    <span class="s1">&#39;bounding_box&#39;</span><span class="p">:</span> <span class="p">[</span>\
</span><span id="__span-35-7">        <span class="mf">0.6646394729614258</span><span class="p">,</span>\
</span><span id="__span-35-8">        <span class="mf">0.7850866247106482</span><span class="p">,</span>\
</span><span id="__span-35-9">        <span class="mf">0.06464214324951172</span><span class="p">,</span>\
</span><span id="__span-35-10">        <span class="mf">0.09088355170355902</span><span class="p">,</span>\
</span><span id="__span-35-11">    <span class="p">],</span>\
</span><span id="__span-35-12">    <span class="s1">&#39;mask&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-13">    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.8933132290840149</span><span class="p">,</span>\
</span><span id="__span-35-14">    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-15"><span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Detection</span><span class="p">:</span> <span class="p">{</span>\
</span><span id="__span-35-16">    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;661858c20ae3edf77139db7b&#39;</span><span class="p">,</span>\
</span><span id="__span-35-17">    <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="p">{},</span>\
</span><span id="__span-35-18">    <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[],</span>\
</span><span id="__span-35-19">    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;car&#39;</span><span class="p">,</span>\
</span><span id="__span-35-20">    <span class="s1">&#39;bounding_box&#39;</span><span class="p">:</span> <span class="p">[</span>\
</span><span id="__span-35-21">        <span class="mf">0.6196376800537109</span><span class="p">,</span>\
</span><span id="__span-35-22">        <span class="mf">0.7399617513020833</span><span class="p">,</span>\
</span><span id="__span-35-23">        <span class="mf">0.06670347849527995</span><span class="p">,</span>\
</span><span id="__span-35-24">        <span class="mf">0.09494832356770834</span><span class="p">,</span>\
</span><span id="__span-35-25">    <span class="p">],</span>\
</span><span id="__span-35-26">    <span class="s1">&#39;mask&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-27">    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.8731599450111389</span><span class="p">,</span>\
</span><span id="__span-35-28">    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-29"><span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Detection</span><span class="p">:</span> <span class="p">{</span>\
</span><span id="__span-35-30">    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;661858c20ae3edf77139db7c&#39;</span><span class="p">,</span>\
</span><span id="__span-35-31">    <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="p">{},</span>\
</span><span id="__span-35-32">    <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[],</span>\
</span><span id="__span-35-33">    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;car&#39;</span><span class="p">,</span>\
</span><span id="__span-35-34">    <span class="s1">&#39;bounding_box&#39;</span><span class="p">:</span> <span class="p">[</span>\
</span><span id="__span-35-35">        <span class="mf">0.5853352228800456</span><span class="p">,</span>\
</span><span id="__span-35-36">        <span class="mf">0.7193766276041667</span><span class="p">,</span>\
</span><span id="__span-35-37">        <span class="mf">0.06686935424804688</span><span class="p">,</span>\
</span><span id="__span-35-38">        <span class="mf">0.07682359483506944</span><span class="p">,</span>\
</span><span id="__span-35-39">    <span class="p">],</span>\
</span><span id="__span-35-40">    <span class="s1">&#39;mask&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-41">    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.8595829606056213</span><span class="p">,</span>\
</span><span id="__span-35-42">    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-43"><span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Detection</span><span class="p">:</span> <span class="p">{</span>\
</span><span id="__span-35-44">    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;661858c20ae3edf77139db7d&#39;</span><span class="p">,</span>\
</span><span id="__span-35-45">    <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="p">{},</span>\
</span><span id="__span-35-46">    <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[],</span>\
</span><span id="__span-35-47">    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;car&#39;</span><span class="p">,</span>\
</span><span id="__span-35-48">    <span class="s1">&#39;bounding_box&#39;</span><span class="p">:</span> <span class="p">[</span>\
</span><span id="__span-35-49">        <span class="mf">0.5635160446166992</span><span class="p">,</span>\
</span><span id="__span-35-50">        <span class="mf">0.686444091796875</span><span class="p">,</span>\
</span><span id="__span-35-51">        <span class="mf">0.06365642547607422</span><span class="p">,</span>\
</span><span id="__span-35-52">        <span class="mf">0.06523607042100694</span><span class="p">,</span>\
</span><span id="__span-35-53">    <span class="p">],</span>\
</span><span id="__span-35-54">    <span class="s1">&#39;mask&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-55">    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.854781448841095</span><span class="p">,</span>\
</span><span id="__span-35-56">    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-57"><span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Detection</span><span class="p">:</span> <span class="p">{</span>\
</span><span id="__span-35-58">    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;661858c20ae3edf77139db7e&#39;</span><span class="p">,</span>\
</span><span id="__span-35-59">    <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="p">{},</span>\
</span><span id="__span-35-60">    <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[],</span>\
</span><span id="__span-35-61">    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;car&#39;</span><span class="p">,</span>\
</span><span id="__span-35-62">    <span class="s1">&#39;bounding_box&#39;</span><span class="p">:</span> <span class="p">[</span>\
</span><span id="__span-35-63">        <span class="mf">0.7365047454833984</span><span class="p">,</span>\
</span><span id="__span-35-64">        <span class="mf">0.8709894816080729</span><span class="p">,</span>\
</span><span id="__span-35-65">        <span class="mf">0.07815799713134766</span><span class="p">,</span>\
</span><span id="__span-35-66">        <span class="mf">0.06583930121527778</span><span class="p">,</span>\
</span><span id="__span-35-67">    <span class="p">],</span>\
</span><span id="__span-35-68">    <span class="s1">&#39;mask&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-69">    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.8482972383499146</span><span class="p">,</span>\
</span><span id="__span-35-70">    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-71"><span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Detection</span><span class="p">:</span> <span class="p">{</span>\
</span><span id="__span-35-72">    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;661858c20ae3edf77139db7f&#39;</span><span class="p">,</span>\
</span><span id="__span-35-73">    <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="p">{},</span>\
</span><span id="__span-35-74">    <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[],</span>\
</span><span id="__span-35-75">    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;car&#39;</span><span class="p">,</span>\
</span><span id="__span-35-76">    <span class="s1">&#39;bounding_box&#39;</span><span class="p">:</span> <span class="p">[</span>\
</span><span id="__span-35-77">        <span class="mf">0.4387975692749023</span><span class="p">,</span>\
</span><span id="__span-35-78">        <span class="mf">0.7973368326822917</span><span class="p">,</span>\
</span><span id="__span-35-79">        <span class="mf">0.07478656768798828</span><span class="p">,</span>\
</span><span id="__span-35-80">        <span class="mf">0.08685709635416666</span><span class="p">,</span>\
</span><span id="__span-35-81">    <span class="p">],</span>\
</span><span id="__span-35-82">    <span class="s1">&#39;mask&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-83">    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.8482537865638733</span><span class="p">,</span>\
</span><span id="__span-35-84">    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-85"><span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Detection</span><span class="p">:</span> <span class="p">{</span>\
</span><span id="__span-35-86">    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;661858c20ae3edf77139db80&#39;</span><span class="p">,</span>\
</span><span id="__span-35-87">    <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="p">{},</span>\
</span><span id="__span-35-88">    <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[],</span>\
</span><span id="__span-35-89">    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;car&#39;</span><span class="p">,</span>\
</span><span id="__span-35-90">    <span class="s1">&#39;bounding_box&#39;</span><span class="p">:</span> <span class="p">[</span>\
</span><span id="__span-35-91">        <span class="mf">0.41441831588745115</span><span class="p">,</span>\
</span><span id="__span-35-92">        <span class="mf">0.7553463971173322</span><span class="p">,</span>\
</span><span id="__span-35-93">        <span class="mf">0.07797966003417969</span><span class="p">,</span>\
</span><span id="__span-35-94">        <span class="mf">0.09232432047526042</span><span class="p">,</span>\
</span><span id="__span-35-95">    <span class="p">],</span>\
</span><span id="__span-35-96">    <span class="s1">&#39;mask&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-97">    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.8444766402244568</span><span class="p">,</span>\
</span><span id="__span-35-98">    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-99"><span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Detection</span><span class="p">:</span> <span class="p">{</span>\
</span><span id="__span-35-100">    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;661858c20ae3edf77139db81&#39;</span><span class="p">,</span>\
</span><span id="__span-35-101">    <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="p">{},</span>\
</span><span id="__span-35-102">    <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[],</span>\
</span><span id="__span-35-103">    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;car&#39;</span><span class="p">,</span>\
</span><span id="__span-35-104">    <span class="s1">&#39;bounding_box&#39;</span><span class="p">:</span> <span class="p">[</span>\
</span><span id="__span-35-105">        <span class="mf">0.4094355583190918</span><span class="p">,</span>\
</span><span id="__span-35-106">        <span class="mf">0.7256359524197049</span><span class="p">,</span>\
</span><span id="__span-35-107">        <span class="mf">0.07238206863403321</span><span class="p">,</span>\
</span><span id="__span-35-108">        <span class="mf">0.07048272026909722</span><span class="p">,</span>\
</span><span id="__span-35-109">    <span class="p">],</span>\
</span><span id="__span-35-110">    <span class="s1">&#39;mask&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-111">    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.798665463924408</span><span class="p">,</span>\
</span><span id="__span-35-112">    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-113"><span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Detection</span><span class="p">:</span> <span class="p">{</span>\
</span><span id="__span-35-114">    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;661858c20ae3edf77139db82&#39;</span><span class="p">,</span>\
</span><span id="__span-35-115">    <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="p">{},</span>\
</span><span id="__span-35-116">    <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[],</span>\
</span><span id="__span-35-117">    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;car&#39;</span><span class="p">,</span>\
</span><span id="__span-35-118">    <span class="s1">&#39;bounding_box&#39;</span><span class="p">:</span> <span class="p">[</span>\
</span><span id="__span-35-119">        <span class="mf">0.5339123407999674</span><span class="p">,</span>\
</span><span id="__span-35-120">        <span class="mf">0.6121687712492766</span><span class="p">,</span>\
</span><span id="__span-35-121">        <span class="mf">0.07190316518147787</span><span class="p">,</span>\
</span><span id="__span-35-122">        <span class="mf">0.07292734781901042</span><span class="p">,</span>\
</span><span id="__span-35-123">    <span class="p">],</span>\
</span><span id="__span-35-124">    <span class="s1">&#39;mask&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-125">    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.7936845421791077</span><span class="p">,</span>\
</span><span id="__span-35-126">    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-127"><span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Detection</span><span class="p">:</span> <span class="p">{</span>\
</span><span id="__span-35-128">    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;661858c20ae3edf77139db83&#39;</span><span class="p">,</span>\
</span><span id="__span-35-129">    <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="p">{},</span>\
</span><span id="__span-35-130">    <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[],</span>\
</span><span id="__span-35-131">    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;car&#39;</span><span class="p">,</span>\
</span><span id="__span-35-132">    <span class="s1">&#39;bounding_box&#39;</span><span class="p">:</span> <span class="p">[</span>\
</span><span id="__span-35-133">        <span class="mf">0.03444666067759196</span><span class="p">,</span>\
</span><span id="__span-35-134">        <span class="mf">0.5164913601345487</span><span class="p">,</span>\
</span><span id="__span-35-135">        <span class="mf">0.03219949007034302</span><span class="p">,</span>\
</span><span id="__span-35-136">        <span class="mf">0.06044175889756945</span><span class="p">,</span>\
</span><span id="__span-35-137">    <span class="p">],</span>\
</span><span id="__span-35-138">    <span class="s1">&#39;mask&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-139">    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.740483820438385</span><span class="p">,</span>\
</span><span id="__span-35-140">    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-141"><span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Detection</span><span class="p">:</span> <span class="p">{</span>\
</span><span id="__span-35-142">    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;661858c20ae3edf77139db84&#39;</span><span class="p">,</span>\
</span><span id="__span-35-143">    <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="p">{},</span>\
</span><span id="__span-35-144">    <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[],</span>\
</span><span id="__span-35-145">    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;car&#39;</span><span class="p">,</span>\
</span><span id="__span-35-146">    <span class="s1">&#39;bounding_box&#39;</span><span class="p">:</span> <span class="p">[</span>\
</span><span id="__span-35-147">        <span class="mf">0.3923538525899251</span><span class="p">,</span>\
</span><span id="__span-35-148">        <span class="mf">0.6745626378942419</span><span class="p">,</span>\
</span><span id="__span-35-149">        <span class="mf">0.06798810958862304</span><span class="p">,</span>\
</span><span id="__span-35-150">        <span class="mf">0.07528584798177083</span><span class="p">,</span>\
</span><span id="__span-35-151">    <span class="p">],</span>\
</span><span id="__span-35-152">    <span class="s1">&#39;mask&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-153">    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.6714914441108704</span><span class="p">,</span>\
</span><span id="__span-35-154">    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-155"><span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Detection</span><span class="p">:</span> <span class="p">{</span>\
</span><span id="__span-35-156">    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;661858c20ae3edf77139db85&#39;</span><span class="p">,</span>\
</span><span id="__span-35-157">    <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="p">{},</span>\
</span><span id="__span-35-158">    <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[],</span>\
</span><span id="__span-35-159">    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;car&#39;</span><span class="p">,</span>\
</span><span id="__span-35-160">    <span class="s1">&#39;bounding_box&#39;</span><span class="p">:</span> <span class="p">[</span>\
</span><span id="__span-35-161">        <span class="mf">0.5216399192810058</span><span class="p">,</span>\
</span><span id="__span-35-162">        <span class="mf">0.5886645846896701</span><span class="p">,</span>\
</span><span id="__span-35-163">        <span class="mf">0.06560036341349283</span><span class="p">,</span>\
</span><span id="__span-35-164">        <span class="mf">0.059334818522135416</span><span class="p">,</span>\
</span><span id="__span-35-165">    <span class="p">],</span>\
</span><span id="__span-35-166">    <span class="s1">&#39;mask&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-167">    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.6649367809295654</span><span class="p">,</span>\
</span><span id="__span-35-168">    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-169"><span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Detection</span><span class="p">:</span> <span class="p">{</span>\
</span><span id="__span-35-170">    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;661858c20ae3edf77139db86&#39;</span><span class="p">,</span>\
</span><span id="__span-35-171">    <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="p">{},</span>\
</span><span id="__span-35-172">    <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[],</span>\
</span><span id="__span-35-173">    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;car&#39;</span><span class="p">,</span>\
</span><span id="__span-35-174">    <span class="s1">&#39;bounding_box&#39;</span><span class="p">:</span> <span class="p">[</span>\
</span><span id="__span-35-175">        <span class="mf">0.5096873283386231</span><span class="p">,</span>\
</span><span id="__span-35-176">        <span class="mf">0.5273054334852431</span><span class="p">,</span>\
</span><span id="__span-35-177">        <span class="mf">0.0551149050394694</span><span class="p">,</span>\
</span><span id="__span-35-178">        <span class="mf">0.07670672381365741</span><span class="p">,</span>\
</span><span id="__span-35-179">    <span class="p">],</span>\
</span><span id="__span-35-180">    <span class="s1">&#39;mask&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-181">    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.6273276805877686</span><span class="p">,</span>\
</span><span id="__span-35-182">    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-183"><span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Detection</span><span class="p">:</span> <span class="p">{</span>\
</span><span id="__span-35-184">    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;661858c20ae3edf77139db87&#39;</span><span class="p">,</span>\
</span><span id="__span-35-185">    <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="p">{},</span>\
</span><span id="__span-35-186">    <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[],</span>\
</span><span id="__span-35-187">    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;car&#39;</span><span class="p">,</span>\
</span><span id="__span-35-188">    <span class="s1">&#39;bounding_box&#39;</span><span class="p">:</span> <span class="p">[</span>\
</span><span id="__span-35-189">        <span class="mf">0.37222995758056643</span><span class="p">,</span>\
</span><span id="__span-35-190">        <span class="mf">0.5739804303204572</span><span class="p">,</span>\
</span><span id="__span-35-191">        <span class="mf">0.06103067398071289</span><span class="p">,</span>\
</span><span id="__span-35-192">        <span class="mf">0.06263699001736112</span><span class="p">,</span>\
</span><span id="__span-35-193">    <span class="p">],</span>\
</span><span id="__span-35-194">    <span class="s1">&#39;mask&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-195">    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.5973840355873108</span><span class="p">,</span>\
</span><span id="__span-35-196">    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-197"><span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Detection</span><span class="p">:</span> <span class="p">{</span>\
</span><span id="__span-35-198">    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;661858c20ae3edf77139db88&#39;</span><span class="p">,</span>\
</span><span id="__span-35-199">    <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="p">{},</span>\
</span><span id="__span-35-200">    <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[],</span>\
</span><span id="__span-35-201">    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;car&#39;</span><span class="p">,</span>\
</span><span id="__span-35-202">    <span class="s1">&#39;bounding_box&#39;</span><span class="p">:</span> <span class="p">[</span>\
</span><span id="__span-35-203">        <span class="mf">0.05044105052947998</span><span class="p">,</span>\
</span><span id="__span-35-204">        <span class="mf">0.44830712212456597</span><span class="p">,</span>\
</span><span id="__span-35-205">        <span class="mf">0.02773451805114746</span><span class="p">,</span>\
</span><span id="__span-35-206">        <span class="mf">0.054146491156684025</span><span class="p">,</span>\
</span><span id="__span-35-207">    <span class="p">],</span>\
</span><span id="__span-35-208">    <span class="s1">&#39;mask&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-209">    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.5668562054634094</span><span class="p">,</span>\
</span><span id="__span-35-210">    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-211"><span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Detection</span><span class="p">:</span> <span class="p">{</span>\
</span><span id="__span-35-212">    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;661858c20ae3edf77139db89&#39;</span><span class="p">,</span>\
</span><span id="__span-35-213">    <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="p">{},</span>\
</span><span id="__span-35-214">    <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[],</span>\
</span><span id="__span-35-215">    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;car&#39;</span><span class="p">,</span>\
</span><span id="__span-35-216">    <span class="s1">&#39;bounding_box&#39;</span><span class="p">:</span> <span class="p">[</span>\
</span><span id="__span-35-217">        <span class="mf">0.38649218877156577</span><span class="p">,</span>\
</span><span id="__span-35-218">        <span class="mf">0.6419422290943287</span><span class="p">,</span>\
</span><span id="__span-35-219">        <span class="mf">0.0629791259765625</span><span class="p">,</span>\
</span><span id="__span-35-220">        <span class="mf">0.05787251790364583</span><span class="p">,</span>\
</span><span id="__span-35-221">    <span class="p">],</span>\
</span><span id="__span-35-222">    <span class="s1">&#39;mask&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-223">    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.525834858417511</span><span class="p">,</span>\
</span><span id="__span-35-224">    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-225"><span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Detection</span><span class="p">:</span> <span class="p">{</span>\
</span><span id="__span-35-226">    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;661858c20ae3edf77139db8a&#39;</span><span class="p">,</span>\
</span><span id="__span-35-227">    <span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="p">{},</span>\
</span><span id="__span-35-228">    <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[],</span>\
</span><span id="__span-35-229">    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;car&#39;</span><span class="p">,</span>\
</span><span id="__span-35-230">    <span class="s1">&#39;bounding_box&#39;</span><span class="p">:</span> <span class="p">[</span>\
</span><span id="__span-35-231">        <span class="mf">3.7088990211486816e-05</span><span class="p">,</span>\
</span><span id="__span-35-232">        <span class="mf">0.5483550460250289</span><span class="p">,</span>\
</span><span id="__span-35-233">        <span class="mf">0.027724572022755942</span><span class="p">,</span>\
</span><span id="__span-35-234">        <span class="mf">0.06541680230034722</span><span class="p">,</span>\
</span><span id="__span-35-235">    <span class="p">],</span>\
</span><span id="__span-35-236">    <span class="s1">&#39;mask&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-237">    <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.5090425610542297</span><span class="p">,</span>\
</span><span id="__span-35-238">    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>\
</span><span id="__span-35-239"><span class="p">}</span><span class="o">&gt;</span><span class="p">]</span>
</span></code></pre></div>
<p>This makes our lives easy, so we can focus on the data and not the nitty gritty details of format conversions.</p>
<p>SAHIâ€™s <code>get_sliced_prediction()</code> function works in the same way as <code>get_prediction()</code>, with a few additional hyperparameters that let us configure how the image is sliced. In particular, we can specify the slice height and width, and the overlap between slices. Hereâ€™s an example:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-36-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-37-1"><span class="n">sliced_result</span> <span class="o">=</span> <span class="n">get_sliced_prediction</span><span class="p">(</span>
</span><span id="__span-37-2">    <span class="n">dataset</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span>
</span><span id="__span-37-3">    <span class="n">detection_model</span><span class="p">,</span>
</span><span id="__span-37-4">    <span class="n">slice_height</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>
</span><span id="__span-37-5">    <span class="n">slice_width</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>
</span><span id="__span-37-6">    <span class="n">overlap_height_ratio</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
</span><span id="__span-37-7">    <span class="n">overlap_width_ratio</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
</span><span id="__span-37-8"><span class="p">)</span>
</span></code></pre></div>
<p>As a sanity check, we can compare the number of detections in the sliced predictions to the number of detections in the original predictions:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-38-1"><span class="p">[</span><span class="mi">91</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-39-1"><span class="n">num_sliced_dets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sliced_result</span><span class="o">.</span><span class="n">to_fiftyone_detections</span><span class="p">())</span>
</span><span id="__span-39-2"><span class="n">num_orig_dets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">to_fiftyone_detections</span><span class="p">())</span>
</span><span id="__span-39-3">
</span><span id="__span-39-4"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Detections predicted without slicing: </span><span class="si">{</span><span class="n">num_orig_dets</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-39-5"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Detections predicted with slicing: </span><span class="si">{</span><span class="n">num_sliced_dets</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-40-1"><span class="n">Detections</span> <span class="n">predicted</span> <span class="n">without</span> <span class="n">slicing</span><span class="p">:</span> <span class="mi">17</span>
</span><span id="__span-40-2"><span class="n">Detections</span> <span class="n">predicted</span> <span class="k">with</span> <span class="n">slicing</span><span class="p">:</span> <span class="mi">73</span>
</span></code></pre></div>
<p>We can see that the number of predictions increased substantially! We have yet to determine if the additional predictions are valid, or if we just have more false positives. Weâ€™ll do this using <a href="https://docs.voxel51.com/user_guide/evaluation.html">FiftyOneâ€™s Evaluation API</a> shortly. We also want to find a good set of hyperparameters for our slicing. To do all of these things, weâ€™re going to need to apply SAHI to the entire dataset. Letâ€™s do that now!</p>
<p>To simplify the process, weâ€™ll define a function that adds predictions to a sample in a specified label field, and then we will iterate over the dataset, applying the function to each sample. This function will pass the sampleâ€™s filepath and slicing hyperparameters to <code>get_sliced_prediction()</code>, and then add the predictions to the sample in the specified label field:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-41-1"><span class="p">[</span><span class="mi">70</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-42-1"><span class="k">def</span><span class="w"> </span><span class="nf">predict_with_slicing</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">label_field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="__span-42-2">    <span class="n">result</span> <span class="o">=</span> <span class="n">get_sliced_prediction</span><span class="p">(</span>
</span><span id="__span-42-3">        <span class="n">sample</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="n">detection_model</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span id="__span-42-4">    <span class="p">)</span>
</span><span id="__span-42-5">    <span class="n">sample</span><span class="p">[</span><span class="n">label_field</span><span class="p">]</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">Detections</span><span class="p">(</span><span class="n">detections</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">to_fiftyone_detections</span><span class="p">())</span>
</span></code></pre></div>
<p>Weâ€™ll keep the slice overlap fixed at 0.20.2, and see how the slice height and width affect the quality of the predictions:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-43-1"><span class="p">[</span><span class="mi">92</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-44-1"><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;overlap_height_ratio&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;overlap_width_ratio&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">}</span>
</span><span id="__span-44-2">
</span><span id="__span-44-3"><span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">iter_samples</span><span class="p">(</span><span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">autosave</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="__span-44-4">    <span class="n">predict_with_slicing</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">label_field</span><span class="o">=</span><span class="s2">&quot;small_slices&quot;</span><span class="p">,</span> <span class="n">slice_height</span><span class="o">=</span><span class="mi">320</span><span class="p">,</span> <span class="n">slice_width</span><span class="o">=</span><span class="mi">320</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-44-5">    <span class="n">predict_with_slicing</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">label_field</span><span class="o">=</span><span class="s2">&quot;large_slices&quot;</span><span class="p">,</span> <span class="n">slice_height</span><span class="o">=</span><span class="mi">480</span><span class="p">,</span> <span class="n">slice_width</span><span class="o">=</span><span class="mi">480</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-45-1"> <span class="mi">100</span><span class="o">%</span> <span class="o">|</span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><span class="o">|</span> <span class="mi">100</span><span class="o">/</span><span class="mi">100</span> <span class="p">[</span><span class="mf">13.6</span><span class="n">m</span> <span class="n">elapsed</span><span class="p">,</span> <span class="mi">0</span><span class="n">s</span> <span class="n">remaining</span><span class="p">,</span> <span class="mf">0.1</span> <span class="n">samples</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-46-1"><span class="mi">04</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2024</span> <span class="mi">10</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">59</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">eta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">utils</span> <span class="o">-</span>    <span class="mi">100</span><span class="o">%</span> <span class="o">|</span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><span class="o">|</span> <span class="mi">100</span><span class="o">/</span><span class="mi">100</span> <span class="p">[</span><span class="mf">13.6</span><span class="n">m</span> <span class="n">elapsed</span><span class="p">,</span> <span class="mi">0</span><span class="n">s</span> <span class="n">remaining</span><span class="p">,</span> <span class="mf">0.1</span> <span class="n">samples</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
</span></code></pre></div>
<p>Note how these inference times are much longer than the original inference time. This is because weâ€™re running the model on multiple slices <em>per</em> image, which increases the number of forward passes the model has to make. This is a trade-off weâ€™re making to improve the detection of small objects.</p>
<p>Now letâ€™s once again filter our labels to only include the classes weâ€™re interested in, and visualize the results in the FiftyOne App:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-47-1"><span class="p">[</span><span class="mi">14</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-48-1"><span class="n">filtered_view</span> <span class="o">=</span> <span class="n">filter_all_labels</span><span class="p">(</span><span class="n">mapped_view</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-49-1"><span class="p">[</span><span class="mi">98</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-50-1"><span class="n">session</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">launch_app</span><span class="p">(</span><span class="n">filtered_view</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-51-1"><span class="n">Session</span> <span class="n">launched</span><span class="o">.</span> <span class="n">Run</span> <span class="err">`</span><span class="n">session</span><span class="o">.</span><span class="n">show</span><span class="p">()</span><span class="err">`</span> <span class="n">to</span> <span class="nb">open</span> <span class="n">the</span> <span class="n">App</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">cell</span> <span class="n">output</span><span class="o">.</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-52-1"><span class="mi">04</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2024</span> <span class="mi">10</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">33</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">fiftyone</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">session</span> <span class="o">-</span>   <span class="n">Session</span> <span class="n">launched</span><span class="o">.</span> <span class="n">Run</span> <span class="err">`</span><span class="n">session</span><span class="o">.</span><span class="n">show</span><span class="p">()</span><span class="err">`</span> <span class="n">to</span> <span class="nb">open</span> <span class="n">the</span> <span class="n">App</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">cell</span> <span class="n">output</span><span class="o">.</span>
</span></code></pre></div>
<p><img alt="Sliced Model Predictions" src="../../_images/sahi_slices.gif" /></p>
<p>The results certainly look promising! From a few visual examples, slicing seems to improve the coverage of ground truth detections, and smaller slices in particular seem to lead to more of the <code>person</code> detections being captured. But how can we know for sure? Letâ€™s run an evaluation routine to mark the detections as true positives, false positives, or false negatives, so that we can compare the sliced predictions to the ground truth. Weâ€™ll use our filtered viewâ€™s <code>evaluate_detections()</code>
method to do this:</p>
<h2 id="evaluating-sahi-predictions">Evaluating SAHI Predictions <a href="#Evaluating-SAHI-Predictions" title="Permalink to this headline">Â¶</a><a class="headerlink" href="#evaluating-sahi-predictions" title="Permanent link">&para;</a></h2>
<h3 id="using-fiftyones-evaluation-api">Using FiftyOneâ€™s Evaluation API <a href="#Using-FiftyOneâ€™s-Evaluation-API" title="Permalink to this headline">Â¶</a><a class="headerlink" href="#using-fiftyones-evaluation-api" title="Permanent link">&para;</a></h3>
<p>Sticking with our filtered view of the dataset, letâ€™s run an evaluation routine comparing our predictions from each of the prediction label fields to the ground truth labels. We will use the <code>evaluate_detections()</code> method, which will mark each detection as a true positive, false positive, or false negative. Here we use the default IoU threshold of 0.50.5, but you can adjust this as needed:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-53-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-54-1"><span class="n">base_results</span> <span class="o">=</span> <span class="n">filtered_view</span><span class="o">.</span><span class="n">evaluate_detections</span><span class="p">(</span><span class="s2">&quot;base_model&quot;</span><span class="p">,</span> <span class="n">gt_field</span><span class="o">=</span><span class="s2">&quot;ground_truth&quot;</span><span class="p">,</span> <span class="n">eval_key</span><span class="o">=</span><span class="s2">&quot;eval_base_model&quot;</span><span class="p">)</span>
</span><span id="__span-54-2"><span class="n">large_slice_results</span> <span class="o">=</span> <span class="n">filtered_view</span><span class="o">.</span><span class="n">evaluate_detections</span><span class="p">(</span><span class="s2">&quot;large_slices&quot;</span><span class="p">,</span> <span class="n">gt_field</span><span class="o">=</span><span class="s2">&quot;ground_truth&quot;</span><span class="p">,</span> <span class="n">eval_key</span><span class="o">=</span><span class="s2">&quot;eval_large_slices&quot;</span><span class="p">)</span>
</span><span id="__span-54-3"><span class="n">small_slice_results</span> <span class="o">=</span> <span class="n">filtered_view</span><span class="o">.</span><span class="n">evaluate_detections</span><span class="p">(</span><span class="s2">&quot;small_slices&quot;</span><span class="p">,</span> <span class="n">gt_field</span><span class="o">=</span><span class="s2">&quot;ground_truth&quot;</span><span class="p">,</span> <span class="n">eval_key</span><span class="o">=</span><span class="s2">&quot;eval_small_slices&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>Letâ€™s print a report for each:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-55-1"><span class="p">[</span><span class="mi">107</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-56-1"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Base model results:&quot;</span><span class="p">)</span>
</span><span id="__span-56-2"><span class="n">base_results</span><span class="o">.</span><span class="n">print_report</span><span class="p">()</span>
</span><span id="__span-56-3">
</span><span id="__span-56-4"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="__span-56-5"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Large slice results:&quot;</span><span class="p">)</span>
</span><span id="__span-56-6"><span class="n">large_slice_results</span><span class="o">.</span><span class="n">print_report</span><span class="p">()</span>
</span><span id="__span-56-7">
</span><span id="__span-56-8"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="__span-56-9"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Small slice results:&quot;</span><span class="p">)</span>
</span><span id="__span-56-10"><span class="n">small_slice_results</span><span class="o">.</span><span class="n">print_report</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-57-1"><span class="n">Base</span> <span class="n">model</span> <span class="n">results</span><span class="p">:</span>
</span><span id="__span-57-2">              <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>
</span><span id="__span-57-3">
</span><span id="__span-57-4">         <span class="n">car</span>       <span class="mf">0.81</span>      <span class="mf">0.55</span>      <span class="mf">0.66</span>       <span class="mi">692</span>
</span><span id="__span-57-5">      <span class="n">person</span>       <span class="mf">0.94</span>      <span class="mf">0.16</span>      <span class="mf">0.28</span>      <span class="mi">7475</span>
</span><span id="__span-57-6">       <span class="n">truck</span>       <span class="mf">0.66</span>      <span class="mf">0.34</span>      <span class="mf">0.45</span>       <span class="mi">265</span>
</span><span id="__span-57-7">
</span><span id="__span-57-8">   <span class="n">micro</span> <span class="n">avg</span>       <span class="mf">0.89</span>      <span class="mf">0.20</span>      <span class="mf">0.33</span>      <span class="mi">8432</span>
</span><span id="__span-57-9">   <span class="n">macro</span> <span class="n">avg</span>       <span class="mf">0.80</span>      <span class="mf">0.35</span>      <span class="mf">0.46</span>      <span class="mi">8432</span>
</span><span id="__span-57-10"><span class="n">weighted</span> <span class="n">avg</span>       <span class="mf">0.92</span>      <span class="mf">0.20</span>      <span class="mf">0.31</span>      <span class="mi">8432</span>
</span><span id="__span-57-11">
</span><span id="__span-57-12"><span class="o">--------------------------------------------------</span>
</span><span id="__span-57-13"><span class="n">Large</span> <span class="nb">slice</span> <span class="n">results</span><span class="p">:</span>
</span><span id="__span-57-14">              <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>
</span><span id="__span-57-15">
</span><span id="__span-57-16">         <span class="n">car</span>       <span class="mf">0.67</span>      <span class="mf">0.71</span>      <span class="mf">0.69</span>       <span class="mi">692</span>
</span><span id="__span-57-17">      <span class="n">person</span>       <span class="mf">0.89</span>      <span class="mf">0.34</span>      <span class="mf">0.49</span>      <span class="mi">7475</span>
</span><span id="__span-57-18">       <span class="n">truck</span>       <span class="mf">0.55</span>      <span class="mf">0.45</span>      <span class="mf">0.49</span>       <span class="mi">265</span>
</span><span id="__span-57-19">
</span><span id="__span-57-20">   <span class="n">micro</span> <span class="n">avg</span>       <span class="mf">0.83</span>      <span class="mf">0.37</span>      <span class="mf">0.51</span>      <span class="mi">8432</span>
</span><span id="__span-57-21">   <span class="n">macro</span> <span class="n">avg</span>       <span class="mf">0.70</span>      <span class="mf">0.50</span>      <span class="mf">0.56</span>      <span class="mi">8432</span>
</span><span id="__span-57-22"><span class="n">weighted</span> <span class="n">avg</span>       <span class="mf">0.86</span>      <span class="mf">0.37</span>      <span class="mf">0.51</span>      <span class="mi">8432</span>
</span><span id="__span-57-23">
</span><span id="__span-57-24"><span class="o">--------------------------------------------------</span>
</span><span id="__span-57-25"><span class="n">Small</span> <span class="nb">slice</span> <span class="n">results</span><span class="p">:</span>
</span><span id="__span-57-26">              <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>
</span><span id="__span-57-27">
</span><span id="__span-57-28">         <span class="n">car</span>       <span class="mf">0.66</span>      <span class="mf">0.75</span>      <span class="mf">0.70</span>       <span class="mi">692</span>
</span><span id="__span-57-29">      <span class="n">person</span>       <span class="mf">0.84</span>      <span class="mf">0.42</span>      <span class="mf">0.56</span>      <span class="mi">7475</span>
</span><span id="__span-57-30">       <span class="n">truck</span>       <span class="mf">0.49</span>      <span class="mf">0.46</span>      <span class="mf">0.47</span>       <span class="mi">265</span>
</span><span id="__span-57-31">
</span><span id="__span-57-32">   <span class="n">micro</span> <span class="n">avg</span>       <span class="mf">0.80</span>      <span class="mf">0.45</span>      <span class="mf">0.57</span>      <span class="mi">8432</span>
</span><span id="__span-57-33">   <span class="n">macro</span> <span class="n">avg</span>       <span class="mf">0.67</span>      <span class="mf">0.54</span>      <span class="mf">0.58</span>      <span class="mi">8432</span>
</span><span id="__span-57-34"><span class="n">weighted</span> <span class="n">avg</span>       <span class="mf">0.82</span>      <span class="mf">0.45</span>      <span class="mf">0.57</span>      <span class="mi">8432</span>
</span></code></pre></div>
<p>We can see that as we introduce more slices, the number of false positives increases, while the number of false negatives decreases. This is expected, as the model is able to detect more objects with more slices, but also makes more mistakes! You could apply more agressive confidence thresholding to combat this increase in false positives, but even without doing this the F1F1-score has significantly improved.</p>
<h3 id="evaluating-performance-on-small-objects">Evaluating Performance on Small Objects <a href="#Evaluating-Performance-on-Small-Objects" title="Permalink to this headline">Â¶</a><a class="headerlink" href="#evaluating-performance-on-small-objects" title="Permanent link">&para;</a></h3>
<p>Letâ€™s dive a little bit deeper into these results. We noted earlier that the model struggles with small objects, so letâ€™s see how these three approaches fare on objects smaller than 32Ã—3232Ã—32 pixels. We can perform this filtering using FiftyOneâ€™s <a href="https://docs.voxel51.com/recipes/creating_views.html#View-expressions">ViewField</a>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-58-1"><span class="p">[</span><span class="mi">110</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-59-1"><span class="c1">## Filtering for only small boxes</span>
</span><span id="__span-59-2">
</span><span id="__span-59-3"><span class="n">box_width</span><span class="p">,</span> <span class="n">box_height</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="s2">&quot;bounding_box&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span> <span class="n">F</span><span class="p">(</span><span class="s2">&quot;bounding_box&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="__span-59-4"><span class="n">rel_bbox_area</span> <span class="o">=</span> <span class="n">box_width</span> <span class="o">*</span> <span class="n">box_height</span>
</span><span id="__span-59-5">
</span><span id="__span-59-6"><span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="s2">&quot;$metadata.width&quot;</span><span class="p">),</span> <span class="n">F</span><span class="p">(</span><span class="s2">&quot;$metadata.height&quot;</span><span class="p">)</span>
</span><span id="__span-59-7"><span class="n">abs_area</span> <span class="o">=</span> <span class="n">rel_bbox_area</span> <span class="o">*</span> <span class="n">im_width</span> <span class="o">*</span> <span class="n">im_height</span>
</span><span id="__span-59-8">
</span><span id="__span-59-9"><span class="n">small_boxes_view</span> <span class="o">=</span> <span class="n">filtered_view</span>
</span><span id="__span-59-10"><span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="n">get_label_fields</span><span class="p">(</span><span class="n">filtered_view</span><span class="p">):</span>
</span><span id="__span-59-11">    <span class="n">small_boxes_view</span> <span class="o">=</span> <span class="n">small_boxes_view</span><span class="o">.</span><span class="n">filter_labels</span><span class="p">(</span><span class="n">lf</span><span class="p">,</span> <span class="n">abs_area</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">only_matches</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-60-1"><span class="p">[</span><span class="mi">111</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-61-1"><span class="n">session</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">small_boxes_view</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
</span></code></pre></div>
<p><img alt="Small Box View" src="../../_images/sahi_small_boxes_view.gif" /></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-62-1"><span class="p">[</span><span class="mi">112</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-63-1"><span class="n">small_boxes_base_results</span> <span class="o">=</span> <span class="n">small_boxes_view</span><span class="o">.</span><span class="n">evaluate_detections</span><span class="p">(</span><span class="s2">&quot;base_model&quot;</span><span class="p">,</span> <span class="n">gt_field</span><span class="o">=</span><span class="s2">&quot;ground_truth&quot;</span><span class="p">,</span> <span class="n">eval_key</span><span class="o">=</span><span class="s2">&quot;eval_small_boxes_base_model&quot;</span><span class="p">)</span>
</span><span id="__span-63-2"><span class="n">small_boxes_large_slice_results</span> <span class="o">=</span> <span class="n">small_boxes_view</span><span class="o">.</span><span class="n">evaluate_detections</span><span class="p">(</span><span class="s2">&quot;large_slices&quot;</span><span class="p">,</span> <span class="n">gt_field</span><span class="o">=</span><span class="s2">&quot;ground_truth&quot;</span><span class="p">,</span> <span class="n">eval_key</span><span class="o">=</span><span class="s2">&quot;eval_small_boxes_large_slices&quot;</span><span class="p">)</span>
</span><span id="__span-63-3"><span class="n">small_boxes_small_slice_results</span> <span class="o">=</span> <span class="n">small_boxes_view</span><span class="o">.</span><span class="n">evaluate_detections</span><span class="p">(</span><span class="s2">&quot;small_slices&quot;</span><span class="p">,</span> <span class="n">gt_field</span><span class="o">=</span><span class="s2">&quot;ground_truth&quot;</span><span class="p">,</span> <span class="n">eval_key</span><span class="o">=</span><span class="s2">&quot;eval_small_boxes_small_slices&quot;</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-64-1"><span class="n">Evaluating</span> <span class="n">detections</span><span class="o">...</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-65-1"><span class="mi">04</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2024</span> <span class="mi">10</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">36</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">fiftyone</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">eval</span><span class="o">.</span><span class="n">detection</span> <span class="o">-</span>   <span class="n">Evaluating</span> <span class="n">detections</span><span class="o">...</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-66-1"> <span class="mi">100</span><span class="o">%</span> <span class="o">|</span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><span class="o">|</span> <span class="mi">100</span><span class="o">/</span><span class="mi">100</span> <span class="p">[</span><span class="mf">1.1</span><span class="n">m</span> <span class="n">elapsed</span><span class="p">,</span> <span class="mi">0</span><span class="n">s</span> <span class="n">remaining</span><span class="p">,</span> <span class="mf">7.8</span> <span class="n">samples</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-67-1"><span class="mi">04</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2024</span> <span class="mi">10</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">44</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">eta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">utils</span> <span class="o">-</span>    <span class="mi">100</span><span class="o">%</span> <span class="o">|</span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><span class="o">|</span> <span class="mi">100</span><span class="o">/</span><span class="mi">100</span> <span class="p">[</span><span class="mf">1.1</span><span class="n">m</span> <span class="n">elapsed</span><span class="p">,</span> <span class="mi">0</span><span class="n">s</span> <span class="n">remaining</span><span class="p">,</span> <span class="mf">7.8</span> <span class="n">samples</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-68-1"><span class="n">Evaluating</span> <span class="n">detections</span><span class="o">...</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-69-1"><span class="mi">04</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2024</span> <span class="mi">10</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">44</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">fiftyone</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">eval</span><span class="o">.</span><span class="n">detection</span> <span class="o">-</span>   <span class="n">Evaluating</span> <span class="n">detections</span><span class="o">...</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-70-1"> <span class="mi">100</span><span class="o">%</span> <span class="o">|</span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><span class="o">|</span> <span class="mi">100</span><span class="o">/</span><span class="mi">100</span> <span class="p">[</span><span class="mf">1.2</span><span class="n">m</span> <span class="n">elapsed</span><span class="p">,</span> <span class="mi">0</span><span class="n">s</span> <span class="n">remaining</span><span class="p">,</span> <span class="mf">6.2</span> <span class="n">samples</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-71-1"><span class="mi">04</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2024</span> <span class="mi">10</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">59</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">eta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">utils</span> <span class="o">-</span>    <span class="mi">100</span><span class="o">%</span> <span class="o">|</span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><span class="o">|</span> <span class="mi">100</span><span class="o">/</span><span class="mi">100</span> <span class="p">[</span><span class="mf">1.2</span><span class="n">m</span> <span class="n">elapsed</span><span class="p">,</span> <span class="mi">0</span><span class="n">s</span> <span class="n">remaining</span><span class="p">,</span> <span class="mf">6.2</span> <span class="n">samples</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-72-1"><span class="n">Evaluating</span> <span class="n">detections</span><span class="o">...</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-73-1"><span class="mi">04</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2024</span> <span class="mi">10</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">59</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">fiftyone</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">eval</span><span class="o">.</span><span class="n">detection</span> <span class="o">-</span>   <span class="n">Evaluating</span> <span class="n">detections</span><span class="o">...</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-74-1"> <span class="mi">100</span><span class="o">%</span> <span class="o">|</span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><span class="o">|</span> <span class="mi">100</span><span class="o">/</span><span class="mi">100</span> <span class="p">[</span><span class="mf">1.4</span><span class="n">m</span> <span class="n">elapsed</span><span class="p">,</span> <span class="mi">0</span><span class="n">s</span> <span class="n">remaining</span><span class="p">,</span> <span class="mf">5.7</span> <span class="n">samples</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-75-1"><span class="mi">04</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2024</span> <span class="mi">10</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">23</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">eta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">utils</span> <span class="o">-</span>    <span class="mi">100</span><span class="o">%</span> <span class="o">|</span><span class="err">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><span class="o">|</span> <span class="mi">100</span><span class="o">/</span><span class="mi">100</span> <span class="p">[</span><span class="mf">1.4</span><span class="n">m</span> <span class="n">elapsed</span><span class="p">,</span> <span class="mi">0</span><span class="n">s</span> <span class="n">remaining</span><span class="p">,</span> <span class="mf">5.7</span> <span class="n">samples</span><span class="o">/</span><span class="n">s</span><span class="p">]</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-76-1"><span class="p">[</span><span class="mi">113</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-77-1"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Small Box â€” Base model results:&quot;</span><span class="p">)</span>
</span><span id="__span-77-2"><span class="n">small_boxes_base_results</span><span class="o">.</span><span class="n">print_report</span><span class="p">()</span>
</span><span id="__span-77-3">
</span><span id="__span-77-4"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="__span-77-5"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Small Box â€” Large slice results:&quot;</span><span class="p">)</span>
</span><span id="__span-77-6"><span class="n">small_boxes_large_slice_results</span><span class="o">.</span><span class="n">print_report</span><span class="p">()</span>
</span><span id="__span-77-7">
</span><span id="__span-77-8"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="__span-77-9"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Small Box â€” Small slice results:&quot;</span><span class="p">)</span>
</span><span id="__span-77-10"><span class="n">small_boxes_small_slice_results</span><span class="o">.</span><span class="n">print_report</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-78-1"><span class="n">Small</span> <span class="n">Box</span> <span class="err">â€”</span> <span class="n">Base</span> <span class="n">model</span> <span class="n">results</span><span class="p">:</span>
</span><span id="__span-78-2">              <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>
</span><span id="__span-78-3">
</span><span id="__span-78-4">         <span class="n">car</span>       <span class="mf">0.71</span>      <span class="mf">0.25</span>      <span class="mf">0.37</span>       <span class="mi">147</span>
</span><span id="__span-78-5">      <span class="n">person</span>       <span class="mf">0.83</span>      <span class="mf">0.08</span>      <span class="mf">0.15</span>      <span class="mi">5710</span>
</span><span id="__span-78-6">       <span class="n">truck</span>       <span class="mf">0.00</span>      <span class="mf">0.00</span>      <span class="mf">0.00</span>        <span class="mi">28</span>
</span><span id="__span-78-7">
</span><span id="__span-78-8">   <span class="n">micro</span> <span class="n">avg</span>       <span class="mf">0.82</span>      <span class="mf">0.08</span>      <span class="mf">0.15</span>      <span class="mi">5885</span>
</span><span id="__span-78-9">   <span class="n">macro</span> <span class="n">avg</span>       <span class="mf">0.51</span>      <span class="mf">0.11</span>      <span class="mf">0.17</span>      <span class="mi">5885</span>
</span><span id="__span-78-10"><span class="n">weighted</span> <span class="n">avg</span>       <span class="mf">0.82</span>      <span class="mf">0.08</span>      <span class="mf">0.15</span>      <span class="mi">5885</span>
</span><span id="__span-78-11">
</span><span id="__span-78-12"><span class="o">--------------------------------------------------</span>
</span><span id="__span-78-13"><span class="n">Small</span> <span class="n">Box</span> <span class="err">â€”</span> <span class="n">Large</span> <span class="nb">slice</span> <span class="n">results</span><span class="p">:</span>
</span><span id="__span-78-14">              <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>
</span><span id="__span-78-15">
</span><span id="__span-78-16">         <span class="n">car</span>       <span class="mf">0.46</span>      <span class="mf">0.48</span>      <span class="mf">0.47</span>       <span class="mi">147</span>
</span><span id="__span-78-17">      <span class="n">person</span>       <span class="mf">0.82</span>      <span class="mf">0.23</span>      <span class="mf">0.35</span>      <span class="mi">5710</span>
</span><span id="__span-78-18">       <span class="n">truck</span>       <span class="mf">0.20</span>      <span class="mf">0.07</span>      <span class="mf">0.11</span>        <span class="mi">28</span>
</span><span id="__span-78-19">
</span><span id="__span-78-20">   <span class="n">micro</span> <span class="n">avg</span>       <span class="mf">0.78</span>      <span class="mf">0.23</span>      <span class="mf">0.36</span>      <span class="mi">5885</span>
</span><span id="__span-78-21">   <span class="n">macro</span> <span class="n">avg</span>       <span class="mf">0.49</span>      <span class="mf">0.26</span>      <span class="mf">0.31</span>      <span class="mi">5885</span>
</span><span id="__span-78-22"><span class="n">weighted</span> <span class="n">avg</span>       <span class="mf">0.80</span>      <span class="mf">0.23</span>      <span class="mf">0.36</span>      <span class="mi">5885</span>
</span><span id="__span-78-23">
</span><span id="__span-78-24"><span class="o">--------------------------------------------------</span>
</span><span id="__span-78-25"><span class="n">Small</span> <span class="n">Box</span> <span class="err">â€”</span> <span class="n">Small</span> <span class="nb">slice</span> <span class="n">results</span><span class="p">:</span>
</span><span id="__span-78-26">              <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>
</span><span id="__span-78-27">
</span><span id="__span-78-28">         <span class="n">car</span>       <span class="mf">0.42</span>      <span class="mf">0.53</span>      <span class="mf">0.47</span>       <span class="mi">147</span>
</span><span id="__span-78-29">      <span class="n">person</span>       <span class="mf">0.79</span>      <span class="mf">0.31</span>      <span class="mf">0.45</span>      <span class="mi">5710</span>
</span><span id="__span-78-30">       <span class="n">truck</span>       <span class="mf">0.21</span>      <span class="mf">0.18</span>      <span class="mf">0.19</span>        <span class="mi">28</span>
</span><span id="__span-78-31">
</span><span id="__span-78-32">   <span class="n">micro</span> <span class="n">avg</span>       <span class="mf">0.75</span>      <span class="mf">0.32</span>      <span class="mf">0.45</span>      <span class="mi">5885</span>
</span><span id="__span-78-33">   <span class="n">macro</span> <span class="n">avg</span>       <span class="mf">0.47</span>      <span class="mf">0.34</span>      <span class="mf">0.37</span>      <span class="mi">5885</span>
</span><span id="__span-78-34"><span class="n">weighted</span> <span class="n">avg</span>       <span class="mf">0.77</span>      <span class="mf">0.32</span>      <span class="mf">0.45</span>      <span class="mi">5885</span>
</span></code></pre></div>
<p>This makes the value of SAHI crystal clear! The recall when using SAHI is much higher for small objects without significant dropoff in precision, leading to improved F1-score. This is especially pronounced for <code>person</code> detections, where the F1F1 score is tripled!</p>
<h3 id="identifying-edge-cases">Identifying Edge Cases <a href="#Identifying-Edge-Cases" title="Permalink to this headline">Â¶</a><a class="headerlink" href="#identifying-edge-cases" title="Permanent link">&para;</a></h3>
<p>Now that we know SAHI is effective at detecting small objects, letâ€™s look at the places where our predictions are most confident but do not align with the ground truth labels. We can do this by creating an evaluation patches view, filtering for predictions tagged as false positives and sorting by confidence:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-79-1"><span class="p">[</span><span class="mi">18</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-80-1"><span class="n">high_conf_fp_view</span> <span class="o">=</span> <span class="n">filtered_view</span><span class="o">.</span><span class="n">to_evaluation_patches</span><span class="p">(</span><span class="n">eval_key</span><span class="o">=</span><span class="s2">&quot;eval_small_slices&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span><span class="o">==</span><span class="s2">&quot;fp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_by</span><span class="p">(</span><span class="s2">&quot;small_slices.detection.confidence&quot;</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-81-1"><span class="p">[</span><span class="mi">19</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-82-1"><span class="n">session</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">high_conf_fp_view</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
</span></code></pre></div>
<p><img alt="False Positives View" src="../../_images/sahi_high_conf_fp_view.jpg" /></p>
<p>Looking at these results, we can see that in many cases, our predictions look quite reasonable, and it seems that the ground truth labels are missing! This is certainly not the case for every prediction, but there are definitely enough to motivate a relabeling of the ground truth data. This is where human-in-the-loop (HITL) workflows can be very useful, as they allow human annotators to review and correct the labels. After this process, we can reevaluate our trained models (with or without SAHI)
on the updated dataset, and then train new models on the updated data.</p>
<h2 id="summary">Summary <a href="#Summary" title="Permalink to this headline">Â¶</a><a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>In this walkthrough, weâ€™ve covered how to add SAHI predictions to your data, and then rigorously evaluate the impacts of slicing on prediction quality. Weâ€™ve seen how slicing-aided hyper-inference (SAHI) can improve the recall and F1F1-score for detection, especially for small objects, without needing to train a model on larger images.</p>
<p>To maximize the effectiveness of SAHI, you may want to experiment with the following:</p>
<ul>
<li>
<p>Slicing hyperparameters, such as slice height and width, and overlap.</p>
</li>
<li>
<p>Base object detection models, as SAHI is compatible with many models, including YOLOv5, and Hugging Face Transformers models.</p>
</li>
<li>
<p>Confidence thresholding (potentially on a class-by-class basis), to reduce the number of false positives.</p>
</li>
<li>
<p>Post-processing techniques, such as <a href="https://docs.voxel51.com/api/fiftyone.utils.labels.html#fiftyone.utils.labels.perform_nms">non-maximum suppression (NMS)</a>, to reduce the number of overlapping detections.</p>
</li>
<li>
<p>Human-in-the-loop (HITL) workflows, to correct ground truth labels.</p>
</li>
</ul>
<p>You will also want to determine which evaluation metrics make the most sense for your use case!</p>
<h2 id="additional-resources">Additional Resources <a href="#Additional-Resources" title="Permalink to this headline">Â¶</a><a class="headerlink" href="#additional-resources" title="Permanent link">&para;</a></h2>
<p>If you found this tutorial helpful, you may also be interested in the following resources:</p>
<ul>
<li>
<p><a href="https://docs.voxel51.com/tutorials/evaluate_detections.html">Tutorial on Evaluating Object Detections</a></p>
</li>
<li>
<p><a href="https://docs.voxel51.com/tutorials/detection_mistakes.html">Tutorial on Finding Object Detection Mistakes</a></p>
</li>
<li>
<p><a href="https://docs.voxel51.com/tutorials/yolov8.html">Tutorial on Fine-tuning YOLOv8 on Custom Data</a></p>
</li>
<li>
<p><a href="https://github.com/allenleetc/model-comparison">FiftyOne Plugin for Comparing Models on Specific Detections</a></p>
</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.path", "navigation.indexes", "navigation.top", {"icon": {"repo": "fontawesome/brands/github"}}, "content.action.edit"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>