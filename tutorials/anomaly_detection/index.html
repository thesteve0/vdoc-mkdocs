
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Anomaly Detection with FiftyOne and Anomalib ¶ - Voxel51 Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#anomaly-detection-with-fiftyone-and-anomalib" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Voxel51 Documentation" class="md-header__button md-logo" aria-label="Voxel51 Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Voxel51 Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Anomaly Detection with FiftyOne and Anomalib ¶
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/thesteve0/vdoc-mkdocs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Voxel51 Documentation" class="md-nav__button md-logo" aria-label="Voxel51 Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Voxel51 Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/thesteve0/vdoc-mkdocs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/virtualenv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virtualenvs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/datasets_samples_fields/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Datasets, Samples, and Fields
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/application_tour/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tour of the Applications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../fiftyone_concepts/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    FiftyOne Concepts
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            FiftyOne Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fiftyone_concepts/basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../brain/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Machine Learning
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recipes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How Do I
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../data_and_models/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Data and Models
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Data and Models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../data_and_models/dataset_zoo/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Zoo Datasets
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Zoo Datasets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_and_models/dataset_zoo/datasets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Built-In Zoo Datasets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_and_models/dataset_zoo/remote/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remotely-Sourced Zoo Datasets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_and_models/dataset_zoo/api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zoo Data API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_and_models/hugging_face_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hugging Face Datasets
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrations
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
          
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../api/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    References
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            References
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLI
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../community/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Community
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../teams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fifty One Teams
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Releases
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      Setup ¶
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup ¶">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Install dependencies ¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-and-visualize-the-mvtec-ad-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      Load and Visualize the MVTec AD dataset ¶
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#train-an-anomaly-detection-model" class="md-nav__link">
    <span class="md-ellipsis">
      Train an Anomaly Detection Model ¶
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluate-anomaly-detection-models" class="md-nav__link">
    <span class="md-ellipsis">
      Evaluate Anomaly Detection Models ¶
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Evaluate Anomaly Detection Models ¶">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compare-anomaly-detection-models" class="md-nav__link">
    <span class="md-ellipsis">
      Compare Anomaly Detection Models ¶
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-data-augmentation-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Test Data Augmentation Techniques ¶
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary ¶
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/thesteve0/vdoc-mkdocs/blob/main/docs/tutorials/anomaly_detection.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="anomaly-detection-with-fiftyone-and-anomalib">Anomaly Detection with FiftyOne and Anomalib <a href="#Anomaly-Detection-with-FiftyOne-and-Anomalib" title="Permalink to this headline">¶</a><a class="headerlink" href="#anomaly-detection-with-fiftyone-and-anomalib" title="Permanent link">&para;</a></h1>
<p><img alt="Anomaly Detection Thumbnail" src="../../_images/anomaly_detection_thumbnail.jpg" /></p>
<p>Anomaly detection (AD) is a crucial task in mission-critical applications such as fraud detection, network security, and medical diagnosis. Anomaly detection on <em>visual</em> data like images, videos, and satellite imagery, is a particularly challenging task due to the high dimensionality of the data and the complexity of the underlying patterns. Yet visual anomaly detection is essential for detecting defects in manufacturing, identifying suspicious activity in surveillance footage, and detecting
abnormalities in medical images.</p>
<p>In this walkthrough, you’ll learn how to perform anomaly detection on visual data using <a href="https://fiftyone.ai/">FiftyOne</a> and <a href="https://github.com/openvinotoolkit/anomalib">Anomalib</a> from the OpenVINO™ toolkit. We’ll use the <a href="https://www.mvtec.com/company/research/datasets/mvtec-ad">MVTec AD dataset</a> for demonstration, which contains images of various objects with anomalies like scratches, dents, and holes.</p>
<p>The notebook covers the following:</p>
<ul>
<li>
<p>What is visual anomaly detection?</p>
</li>
<li>
<p>Loading the MVTec AD dataset in FiftyOne</p>
</li>
<li>
<p>Training an anomaly detection model with Anomalib</p>
</li>
<li>
<p>Evaluating anomaly detection models in FiftyOne</p>
</li>
</ul>
<h2 id="setup">Setup <a href="#Setup" title="Permalink to this headline">¶</a><a class="headerlink" href="#setup" title="Permanent link">&para;</a></h2>
<h3 id="install-dependencies">Install dependencies <a href="#Install-dependencies" title="Permalink to this headline">¶</a><a class="headerlink" href="#install-dependencies" title="Permanent link">&para;</a></h3>
<p>Make sure you are running this in a virtual environment with <code>python=3.10</code>.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">conda</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="n">anomalib_env</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.10</span><span class="p">;</span> <span class="n">conda</span> <span class="n">activate</span> <span class="n">anomalib_env</span>
</span></code></pre></div>
<p>Anomalib requires Python 3.10, so make sure you have the correct version installed.</p>
<p>After this, install Anomalib and its dependencies. If you’re running this in a colab notebook, the installation might take a few minutes, but local installation should be faster.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">U</span> <span class="n">torchvision</span> <span class="n">einops</span> <span class="n">FrEIA</span> <span class="n">timm</span> <span class="n">open_clip_torch</span> <span class="n">imgaug</span> <span class="n">lightning</span> <span class="n">kornia</span> <span class="n">openvino</span> <span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">openvinotoolkit</span><span class="o">/</span><span class="n">anomalib</span><span class="o">.</span><span class="n">git</span>
</span></code></pre></div>
<p>Install Anomalib from source, per the instructions in the <a href="https://github.com/openvinotoolkit/anomalib?tab=readme-ov-file#-installation">Anomalib README</a></p>
<p>If you don’t have it already installed, install FiftyOne. Make sure your version is <code>fiftyone&gt;=0.23.8</code> so we can use the <a href="https://docs.voxel51.com/integrations/huggingface.html#huggingface-hub">Hugging Face Hub integration</a> to load the MVTec AD dataset:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">U</span> <span class="n">fiftyone</span>
</span></code></pre></div>
<p>Just a few more packages to install, and we’re ready to go. Now you can see why we recommend using a virtual environment for this project!</p>
<ul>
<li>
<p><code>huggingface_hub</code> for loading the MVTec AD dataset</p>
</li>
<li>
<p><code>clip</code> for computing image embeddings</p>
</li>
<li>
<p><code>umap-learn</code> for dimensionality reduction</p>
</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">U</span> <span class="n">huggingface_hub</span> <span class="n">umap</span><span class="o">-</span><span class="n">learn</span> <span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">openai</span><span class="o">/</span><span class="n">CLIP</span><span class="o">.</span><span class="n">git</span>
</span></code></pre></div>
<h3 id="load-and-visualize-the-mvtec-ad-dataset">Load and Visualize the MVTec AD dataset <a href="#Load-and-Visualize-the-MVTec-AD-dataset" title="Permalink to this headline">¶</a><a class="headerlink" href="#load-and-visualize-the-mvtec-ad-dataset" title="Permanent link">&para;</a></h3>
<p>Now let’s import all of the relevant modules we will need from FiftyOne:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><span class="kn">import</span><span class="w"> </span><span class="nn">fiftyone</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">fo</span> <span class="c1"># base library and app</span>
</span><span id="__span-8-2"><span class="kn">import</span><span class="w"> </span><span class="nn">fiftyone.brain</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">fob</span> <span class="c1"># ML methods</span>
</span><span id="__span-8-3"><span class="kn">import</span><span class="w"> </span><span class="nn">fiftyone.zoo</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">foz</span> <span class="c1"># zoo datasets and models</span>
</span><span id="__span-8-4"><span class="kn">from</span><span class="w"> </span><span class="nn">fiftyone</span><span class="w"> </span><span class="kn">import</span> <span class="n">ViewField</span> <span class="k">as</span> <span class="n">F</span> <span class="c1"># helper for defining views</span>
</span><span id="__span-8-5"><span class="kn">import</span><span class="w"> </span><span class="nn">fiftyone.utils.huggingface</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">fouh</span> <span class="c1"># Hugging Face integration</span>
</span></code></pre></div>
<p>And load the <a href="https://huggingface.co/datasets/Voxel51/mvtec-ad">MVTec AD dataset from the Hugging Face Hub</a>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><span class="n">dataset</span> <span class="o">=</span> <span class="n">fouh</span><span class="o">.</span><span class="n">load_from_hub</span><span class="p">(</span><span class="s2">&quot;Voxel51/mvtec-ad&quot;</span><span class="p">,</span> <span class="n">persistent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div>
<p>💡 It is also possible to load the MVTec AD data directly from Anomalib:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><span class="kn">from</span><span class="w"> </span><span class="nn">anomalib.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">MVTec</span>
</span><span id="__span-11-2"><span class="n">datamodule</span> <span class="o">=</span> <span class="n">MVTec</span><span class="p">()</span>
</span></code></pre></div>
<p>But this way we have all of the metadata and annotations in FiftyOne, which is useful for visualization and evaluation.</p>
<p>Before moving on, let’s take a look at the dataset in the <a href="https://docs.voxel51.com/user_guide/app.html">FiftyOne App</a>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><span class="n">session</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">launch_app</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</span></code></pre></div>
<p><img alt="MVTec AD Dataset" src="../../_images/anomaly_detection_initial_dataset.gif" /></p>
<p>The dataset has 5354 images across 12 object categories. Each category has “good” images and “anomalous” images with defects like scratches, dents, and holes. Each of the anomalous samples also has a mask which localizes the defective regions of the image.</p>
<p>The defect labels differ across categories, which is typical in real-world anomaly detection scenarios. In typical anomaly detection scenarios, you train a different model for each category. Here we’ll go through the process for one category, and you can apply the same steps to other categories.</p>
<p>One more thing to note is that the dataset is split into training and test sets. The training set contains only “good” images, while the test set contains both “good” and “anomalous” images.</p>
<p>Before we train a model, let’s dig into the dataset a bit more. We can get a feel for the structure and patterns hidden in our data by computing image embeddings and visualizing them in a lower-dimensional space. First, we’ll compute embeddings for all the images in the dataset using the <a href="https://github.com/openai/CLIP">CLIP model</a>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><span class="n">model</span> <span class="o">=</span> <span class="n">foz</span><span class="o">.</span><span class="n">load_zoo_model</span><span class="p">(</span>
</span><span id="__span-15-2">    <span class="s2">&quot;clip-vit-base32-torch&quot;</span>
</span><span id="__span-15-3"><span class="p">)</span>  <span class="c1"># load the CLIP model from the zoo</span>
</span><span id="__span-15-4">
</span><span id="__span-15-5"><span class="c1"># Compute embeddings for the dataset</span>
</span><span id="__span-15-6"><span class="n">dataset</span><span class="o">.</span><span class="n">compute_embeddings</span><span class="p">(</span>
</span><span id="__span-15-7">    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">embeddings_field</span><span class="o">=</span><span class="s2">&quot;clip_embeddings&quot;</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span>
</span><span id="__span-15-8"><span class="p">)</span>
</span><span id="__span-15-9">
</span><span id="__span-15-10"><span class="c1"># Dimensionality reduction using UMAP on the embeddings</span>
</span><span id="__span-15-11"><span class="n">fob</span><span class="o">.</span><span class="n">compute_visualization</span><span class="p">(</span>
</span><span id="__span-15-12">    <span class="n">dataset</span><span class="p">,</span> <span class="n">embeddings</span><span class="o">=</span><span class="s2">&quot;clip_embeddings&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;umap&quot;</span><span class="p">,</span> <span class="n">brain_key</span><span class="o">=</span><span class="s2">&quot;clip_vis&quot;</span>
</span><span id="__span-15-13"><span class="p">)</span>
</span></code></pre></div>
<p>Refresh the FiftyOne App, click the “+” tab, and select “Embeddings”. Choose “all_clip_vis” from the dropdown menu. You’ll see a scatter plot of the image embeddings in a 2D space, where each point corresponds to a sample in the dataset. Using the color-by dropdown, notice how the embeddings cluster based on the object category. This is because CLIP encodes semantic information about the images. Also note that <em>within</em> a category, CLIP embeddings don’t cluster based on the defect type.</p>
<p><img alt="CLIP Embeddings" src="../../_images/anomaly_detection_clip_embeddings.gif" /></p>
<p>If instead we embed our images using a traditional computer vision model like ResNet, we also see some clustering within a category based on the defect type. However, as we established earlier, we will not have access to defect labels during inference. Instead, we’ll use an unsupervised anomaly detection model.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><span class="n">model</span> <span class="o">=</span> <span class="n">foz</span><span class="o">.</span><span class="n">load_zoo_model</span><span class="p">(</span>
</span><span id="__span-17-2">    <span class="s2">&quot;resnet50-imagenet-torch&quot;</span>
</span><span id="__span-17-3"><span class="p">)</span>  <span class="c1"># load the ResNet50 model from the zoo</span>
</span><span id="__span-17-4">
</span><span id="__span-17-5"><span class="c1"># Compute embeddings for the dataset — this might take a while on a CPU</span>
</span><span id="__span-17-6"><span class="n">dataset</span><span class="o">.</span><span class="n">compute_embeddings</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">embeddings_field</span><span class="o">=</span><span class="s2">&quot;resnet50_embeddings&quot;</span><span class="p">)</span>
</span><span id="__span-17-7">
</span><span id="__span-17-8"><span class="c1"># Dimensionality reduction using UMAP on the embeddings</span>
</span><span id="__span-17-9"><span class="n">fob</span><span class="o">.</span><span class="n">compute_visualization</span><span class="p">(</span>
</span><span id="__span-17-10">    <span class="n">dataset</span><span class="p">,</span>
</span><span id="__span-17-11">    <span class="n">embeddings</span><span class="o">=</span><span class="s2">&quot;resnet50_embeddings&quot;</span><span class="p">,</span>
</span><span id="__span-17-12">    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;umap&quot;</span><span class="p">,</span>
</span><span id="__span-17-13">    <span class="n">brain_key</span><span class="o">=</span><span class="s2">&quot;resnet50_vis&quot;</span><span class="p">,</span>
</span><span id="__span-17-14"><span class="p">)</span>
</span></code></pre></div>
<p><img alt="ResNet50 Embeddings" src="../../_images/anomaly_detection_resnet50_embeddings.gif" /></p>
<p>💡 For deep dives into embeddings and dimensionality reduction, check out our tutorials:</p>
<ul>
<li>
<p><a href="https://docs.voxel51.com/tutorials/image_embeddings.html">Using Image Embeddings</a></p>
</li>
<li>
<p><a href="https://docs.voxel51.com/tutorials/dimension_reduction.html">Visualizing Data with Dimensionality Reduction Techniques</a></p>
</li>
</ul>
<h2 id="train-an-anomaly-detection-model">Train an Anomaly Detection Model <a href="#Train-an-Anomaly-Detection-Model" title="Permalink to this headline">¶</a><a class="headerlink" href="#train-an-anomaly-detection-model" title="Permanent link">&para;</a></h2>
<p>Now that we have a sense of the dataset, we’re ready to train an anomaly detection model using Anomalib.</p>
<p><strong>Task</strong>: Anomalib supports classification, detection, and segmentation tasks for images. We’ll focus on segmentation, where the model predicts whether each pixel in the image is anomalous or not, creating a mask that localizes the defect.</p>
<p><strong>Model</strong>: Anomalib supports a variety of anomaly detection algorithms, including <a href="https://anomalib.readthedocs.io/en/v1.0.1/markdown/guides/reference/models/image/dfkde.html">Deep Feature Kernel Density Estimation (DFKDE)</a>, <a href="https://arxiv.org/abs/2111.07677">FastFlow</a>, and <a href="https://arxiv.org/abs/2201.10703v2">Reverse Distillation</a>. For a complete list of supported algorithms, check out <a href="https://anomalib.readthedocs.io/en/v1.0.1/markdown/guides/reference/models/image/index.html">Anomalib’s reference\
guide</a>. For this walkthrough, we’ll use two algorithms:</p>
<ul>
<li>
<p><a href="https://arxiv.org/abs/2011.08785">PaDiM: a Patch Distribution Modeling Framework for Anomaly Detection and Localization</a></p>
</li>
<li>
<p><a href="https://arxiv.org/abs/2106.08265">PatchCore: Towards Total Recall in Industrial Anomaly Detection</a></p>
</li>
</ul>
<p><strong>Preprocessing</strong>: For this walkthrough, we will resize the images to 256x256 pixels before training the model. Adding this as a transform via Torchvision’s <code>Resize</code> class lets us resize the images on-the-fly during training and inference.</p>
<p>Import the necessary modules from Anomalib and helper modules for processing images and paths:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><span class="p">[</span><span class="mi">15</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="__span-19-2"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-19-3"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-19-4"><span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
</span><span id="__span-19-5"><span class="kn">from</span><span class="w"> </span><span class="nn">torchvision.transforms.v2</span><span class="w"> </span><span class="kn">import</span> <span class="n">Resize</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><span class="kn">from</span><span class="w"> </span><span class="nn">anomalib</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaskType</span>
</span><span id="__span-21-2"><span class="kn">from</span><span class="w"> </span><span class="nn">anomalib.data.image.folder</span><span class="w"> </span><span class="kn">import</span> <span class="n">Folder</span>
</span><span id="__span-21-3"><span class="kn">from</span><span class="w"> </span><span class="nn">anomalib.deploy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExportType</span><span class="p">,</span> <span class="n">OpenVINOInferencer</span>
</span><span id="__span-21-4"><span class="kn">from</span><span class="w"> </span><span class="nn">anomalib.engine</span><span class="w"> </span><span class="kn">import</span> <span class="n">Engine</span>
</span><span id="__span-21-5"><span class="kn">from</span><span class="w"> </span><span class="nn">anomalib.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Padim</span><span class="p">,</span> <span class="n">Patchcore</span>
</span></code></pre></div>
<p>Now define some constants to use throughout the notebook.</p>
<ul>
<li>
<p><code>OBJECT</code>: The object category we’ll focus on. For this walkthrough, we’ll use “bottle”. If you want to loop over categories, you can get the list of categories from the dataset with <code>dataset.distinct("category.label")</code>.</p>
</li>
<li>
<p><code>ROOT_DIR</code>: The root directory where Anomalib will look for images and masks. Our data is already stored on disk, so we will just symlink files to the directory Anomalib expects.</p>
</li>
<li>
<p><code>TASK</code>: The task we’re performing. We’ll use “segmentation” for this walkthrough.</p>
</li>
<li>
<p><code>IMAGE_SIZE</code>: The size to resize images to before training the model. We’ll use 256256 x 256256 pixels.</p>
</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><span class="p">[</span><span class="mi">17</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><span class="n">OBJECT</span> <span class="o">=</span> <span class="s2">&quot;bottle&quot;</span> <span class="c1">## object to train on</span>
</span><span id="__span-23-2"><span class="n">ROOT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/tmp/mvtec_ad&quot;</span><span class="p">)</span> <span class="c1">## root directory to store data for anomalib</span>
</span><span id="__span-23-3"><span class="n">TASK</span> <span class="o">=</span> <span class="n">TaskType</span><span class="o">.</span><span class="n">SEGMENTATION</span> <span class="c1">## task type for the model</span>
</span><span id="__span-23-4"><span class="n">IMAGE_SIZE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span> <span class="c1">## preprocess image size for uniformity</span>
</span></code></pre></div>
<p>For a given object type (category), the <code>create_datamodule()</code> function below creates an Anomalib <code>DataModule</code> object. This will get passed into our engine’s <code>fit()</code> method to train the model, and will be used to instantiate dataloaders for training and validation.</p>
<p>The code might look complex, so let’s break down what’s going on:</p>
<ul>
<li>
<p>We create subsets of our data containing only the “good” training images and “anomalous” images for validation.</p>
</li>
<li>
<p>We symlink the images and masks to the directory Anomalib expects.</p>
</li>
<li>
<p>We instantiate and setup a datamodule from Anomalib’s <code>Folder</code>, which is the general-purpose class for custom datasets.</p>
</li>
</ul>
<p>💡 It is also possible to create a torch <code>DataLoader</code> from scratch and pass it to the engine’s <code>fit()</code> method. This gives you more control over the data loading process. This is left as an exercise for the reader 😉.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><span class="p">[</span><span class="mi">21</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><span class="k">def</span><span class="w"> </span><span class="nf">create_datamodule</span><span class="p">(</span><span class="n">object_type</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-25-2">    <span class="c1">## Build transform</span>
</span><span id="__span-25-3">    <span class="k">if</span> <span class="n">transform</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-25-4">        <span class="n">transform</span> <span class="o">=</span> <span class="n">Resize</span><span class="p">(</span><span class="n">IMAGE_SIZE</span><span class="p">,</span> <span class="n">antialias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-25-5">
</span><span id="__span-25-6">    <span class="n">normal_data</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">&quot;category.label&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">object_type</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
</span><span id="__span-25-7">        <span class="n">F</span><span class="p">(</span><span class="s2">&quot;split&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;train&quot;</span>
</span><span id="__span-25-8">    <span class="p">)</span>
</span><span id="__span-25-9">    <span class="n">abnormal_data</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-25-10">        <span class="n">dataset</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">&quot;category.label&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">object_type</span><span class="p">)</span>
</span><span id="__span-25-11">        <span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">&quot;split&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span>
</span><span id="__span-25-12">        <span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">&quot;defect.label&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;good&quot;</span><span class="p">)</span>
</span><span id="__span-25-13">    <span class="p">)</span>
</span><span id="__span-25-14">
</span><span id="__span-25-15">    <span class="n">normal_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">ROOT_DIR</span><span class="p">)</span> <span class="o">/</span> <span class="n">object_type</span> <span class="o">/</span> <span class="s2">&quot;normal&quot;</span>
</span><span id="__span-25-16">    <span class="n">abnormal_dir</span> <span class="o">=</span> <span class="n">ROOT_DIR</span> <span class="o">/</span> <span class="n">object_type</span> <span class="o">/</span> <span class="s2">&quot;abnormal&quot;</span>
</span><span id="__span-25-17">    <span class="n">mask_dir</span> <span class="o">=</span> <span class="n">ROOT_DIR</span> <span class="o">/</span> <span class="n">object_type</span> <span class="o">/</span> <span class="s2">&quot;mask&quot;</span>
</span><span id="__span-25-18">
</span><span id="__span-25-19">    <span class="c1"># create directories if they do not exist</span>
</span><span id="__span-25-20">    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">normal_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-25-21">    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">abnormal_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-25-22">    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">mask_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-25-23">
</span><span id="__span-25-24">    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">normal_dir</span><span class="p">)):</span>
</span><span id="__span-25-25">        <span class="n">normal_data</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
</span><span id="__span-25-26">            <span class="n">export_dir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">normal_dir</span><span class="p">),</span>
</span><span id="__span-25-27">            <span class="n">dataset_type</span><span class="o">=</span><span class="n">fo</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">ImageDirectory</span><span class="p">,</span>
</span><span id="__span-25-28">            <span class="n">export_media</span><span class="o">=</span><span class="s2">&quot;symlink&quot;</span><span class="p">,</span>
</span><span id="__span-25-29">        <span class="p">)</span>
</span><span id="__span-25-30">
</span><span id="__span-25-31">    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">abnormal_data</span><span class="o">.</span><span class="n">iter_samples</span><span class="p">():</span>
</span><span id="__span-25-32">        <span class="n">base_filename</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">filename</span>
</span><span id="__span-25-33">        <span class="n">dir_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-25-34">        <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dir_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">base_filename</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-25-35">        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">abnormal_dir</span> <span class="o">/</span> <span class="n">new_filename</span><span class="p">)):</span>
</span><span id="__span-25-36">            <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">abnormal_dir</span> <span class="o">/</span> <span class="n">new_filename</span><span class="p">))</span>
</span><span id="__span-25-37">
</span><span id="__span-25-38">        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">mask_dir</span> <span class="o">/</span> <span class="n">new_filename</span><span class="p">)):</span>
</span><span id="__span-25-39">            <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">defect_mask</span><span class="o">.</span><span class="n">mask_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">mask_dir</span> <span class="o">/</span> <span class="n">new_filename</span><span class="p">))</span>
</span><span id="__span-25-40">
</span><span id="__span-25-41">    <span class="n">datamodule</span> <span class="o">=</span> <span class="n">Folder</span><span class="p">(</span>
</span><span id="__span-25-42">        <span class="n">name</span><span class="o">=</span><span class="n">object_type</span><span class="p">,</span>
</span><span id="__span-25-43">        <span class="n">root</span><span class="o">=</span><span class="n">ROOT_DIR</span><span class="p">,</span>
</span><span id="__span-25-44">        <span class="n">normal_dir</span><span class="o">=</span><span class="n">normal_dir</span><span class="p">,</span>
</span><span id="__span-25-45">        <span class="n">abnormal_dir</span><span class="o">=</span><span class="n">abnormal_dir</span><span class="p">,</span>
</span><span id="__span-25-46">        <span class="n">mask_dir</span><span class="o">=</span><span class="n">mask_dir</span><span class="p">,</span>
</span><span id="__span-25-47">        <span class="n">task</span><span class="o">=</span><span class="n">TASK</span><span class="p">,</span>
</span><span id="__span-25-48">        <span class="n">transform</span><span class="o">=</span><span class="n">transform</span>
</span><span id="__span-25-49">    <span class="p">)</span>
</span><span id="__span-25-50">    <span class="n">datamodule</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
</span><span id="__span-25-51">    <span class="k">return</span> <span class="n">datamodule</span>
</span></code></pre></div>
<p>Now we can put it all together. The <code>train_and_export_model()</code> function below trains an anomaly detection model using Anomalib’s <code>Engine</code> class, exports the model to OpenVINO, and returns the model “inferencer” object. The inferencer object is used to make predictions on new images.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-26-1"><span class="p">[</span><span class="mi">19</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-27-1"><span class="k">def</span><span class="w"> </span><span class="nf">train_and_export_model</span><span class="p">(</span><span class="n">object_type</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-27-2">    <span class="n">engine</span> <span class="o">=</span> <span class="n">Engine</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">TASK</span><span class="p">)</span>
</span><span id="__span-27-3">    <span class="n">datamodule</span> <span class="o">=</span> <span class="n">create_datamodule</span><span class="p">(</span><span class="n">object_type</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>
</span><span id="__span-27-4">    <span class="n">engine</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">datamodule</span><span class="o">=</span><span class="n">datamodule</span><span class="p">)</span>
</span><span id="__span-27-5">
</span><span id="__span-27-6">    <span class="n">engine</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
</span><span id="__span-27-7">        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
</span><span id="__span-27-8">        <span class="n">export_type</span><span class="o">=</span><span class="n">ExportType</span><span class="o">.</span><span class="n">OPENVINO</span><span class="p">,</span>
</span><span id="__span-27-9">    <span class="p">)</span>
</span><span id="__span-27-10">    <span class="n">output_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">default_root_dir</span><span class="p">)</span>
</span><span id="__span-27-11">
</span><span id="__span-27-12">    <span class="n">openvino_model_path</span> <span class="o">=</span> <span class="n">output_path</span> <span class="o">/</span> <span class="s2">&quot;weights&quot;</span> <span class="o">/</span> <span class="s2">&quot;openvino&quot;</span> <span class="o">/</span> <span class="s2">&quot;model.bin&quot;</span>
</span><span id="__span-27-13">    <span class="n">metadata</span> <span class="o">=</span> <span class="n">output_path</span> <span class="o">/</span> <span class="s2">&quot;weights&quot;</span> <span class="o">/</span> <span class="s2">&quot;openvino&quot;</span> <span class="o">/</span> <span class="s2">&quot;metadata.json&quot;</span>
</span><span id="__span-27-14">
</span><span id="__span-27-15">    <span class="n">inferencer</span> <span class="o">=</span> <span class="n">OpenVINOInferencer</span><span class="p">(</span>
</span><span id="__span-27-16">        <span class="n">path</span><span class="o">=</span><span class="n">openvino_model_path</span><span class="p">,</span>
</span><span id="__span-27-17">        <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
</span><span id="__span-27-18">        <span class="n">device</span><span class="o">=</span><span class="s2">&quot;CPU&quot;</span><span class="p">,</span>
</span><span id="__span-27-19">    <span class="p">)</span>
</span><span id="__span-27-20">    <span class="k">return</span> <span class="n">inferencer</span>
</span></code></pre></div>
<p>Let’s try this with <code>PaDiM</code> first. The training process should take less than a minute:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-28-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-29-1"><span class="n">model</span> <span class="o">=</span> <span class="n">Padim</span><span class="p">()</span>
</span><span id="__span-29-2">
</span><span id="__span-29-3"><span class="n">inferencer</span> <span class="o">=</span> <span class="n">train_and_export_model</span><span class="p">(</span><span class="n">OBJECT</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</span></code></pre></div>
<p>And just like that, we have an anomaly detection model trained on the “bottle” category. Let’s run our inferencer on a single image and inspect the results:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-30-1"><span class="p">[</span><span class="mi">23</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-31-1"><span class="c1">## get the test split of the dataset</span>
</span><span id="__span-31-2"><span class="n">test_split</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">&quot;category.label&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">OBJECT</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
</span><span id="__span-31-3">    <span class="n">F</span><span class="p">(</span><span class="s2">&quot;split&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;test&quot;</span>
</span><span id="__span-31-4"><span class="p">)</span>
</span><span id="__span-31-5">
</span><span id="__span-31-6"><span class="c1">## get the first sample from the test split</span>
</span><span id="__span-31-7"><span class="n">test_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">test_split</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span>
</span><span id="__span-31-8">
</span><span id="__span-31-9"><span class="n">output</span> <span class="o">=</span> <span class="n">inferencer</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">test_image</span><span class="p">)</span>
</span><span id="__span-31-10"><span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-32-1"><span class="n">ImageResult</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="p">[[[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-2">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-3">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-4">  <span class="o">...</span>\
</span><span id="__span-32-5">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-6">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-7">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]]</span>\
</span><span id="__span-32-8">\
</span><span id="__span-32-9"> <span class="p">[[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-10">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-11">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-12">  <span class="o">...</span>\
</span><span id="__span-32-13">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-14">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-15">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]]</span>\
</span><span id="__span-32-16">\
</span><span id="__span-32-17"> <span class="p">[[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-18">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-19">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-20">  <span class="o">...</span>\
</span><span id="__span-32-21">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-22">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-23">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]]</span>\
</span><span id="__span-32-24">\
</span><span id="__span-32-25"> <span class="o">...</span>\
</span><span id="__span-32-26">\
</span><span id="__span-32-27"> <span class="p">[[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-28">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-29">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-30">  <span class="o">...</span>\
</span><span id="__span-32-31">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-32">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-33">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]]</span>\
</span><span id="__span-32-34">\
</span><span id="__span-32-35"> <span class="p">[[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-36">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-37">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-38">  <span class="o">...</span>\
</span><span id="__span-32-39">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-40">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-41">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]]</span>\
</span><span id="__span-32-42">\
</span><span id="__span-32-43"> <span class="p">[[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-44">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-45">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-46">  <span class="o">...</span>\
</span><span id="__span-32-47">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-48">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-49">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]]],</span> <span class="n">pred_score</span><span class="o">=</span><span class="mf">0.7751642969087686</span><span class="p">,</span> <span class="n">pred_label</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">anomaly_map</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.32784402</span> <span class="mf">0.32784402</span> <span class="mf">0.32784414</span> <span class="o">...</span> <span class="mf">0.3314721</span>  <span class="mf">0.33147204</span> <span class="mf">0.33147204</span><span class="p">]</span>\
</span><span id="__span-32-50"> <span class="p">[</span><span class="mf">0.32784402</span> <span class="mf">0.32784402</span> <span class="mf">0.32784414</span> <span class="o">...</span> <span class="mf">0.3314721</span>  <span class="mf">0.33147204</span> <span class="mf">0.33147204</span><span class="p">]</span>\
</span><span id="__span-32-51"> <span class="p">[</span><span class="mf">0.32784408</span> <span class="mf">0.32784408</span> <span class="mf">0.3278442</span>  <span class="o">...</span> <span class="mf">0.33147222</span> <span class="mf">0.33147216</span> <span class="mf">0.33147216</span><span class="p">]</span>\
</span><span id="__span-32-52"> <span class="o">...</span>\
</span><span id="__span-32-53"> <span class="p">[</span><span class="mf">0.32959</span>    <span class="mf">0.32959</span>    <span class="mf">0.32959005</span> <span class="o">...</span> <span class="mf">0.3336093</span>  <span class="mf">0.3336093</span>  <span class="mf">0.3336093</span> <span class="p">]</span>\
</span><span id="__span-32-54"> <span class="p">[</span><span class="mf">0.3295899</span>  <span class="mf">0.3295899</span>  <span class="mf">0.32958996</span> <span class="o">...</span> <span class="mf">0.33360928</span> <span class="mf">0.33360928</span> <span class="mf">0.33360928</span><span class="p">]</span>\
</span><span id="__span-32-55"> <span class="p">[</span><span class="mf">0.3295899</span>  <span class="mf">0.3295899</span>  <span class="mf">0.32958996</span> <span class="o">...</span> <span class="mf">0.33360928</span> <span class="mf">0.33360928</span> <span class="mf">0.33360928</span><span class="p">]],</span> <span class="n">gt_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gt_boxes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pred_boxes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">box_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pred_mask</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="o">...</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">]</span>\
</span><span id="__span-32-56"> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="o">...</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">]</span>\
</span><span id="__span-32-57"> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="o">...</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">]</span>\
</span><span id="__span-32-58"> <span class="o">...</span>\
</span><span id="__span-32-59"> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="o">...</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">]</span>\
</span><span id="__span-32-60"> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="o">...</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">]</span>\
</span><span id="__span-32-61"> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="o">...</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">heat_map</span><span class="o">=</span><span class="p">[[[</span><span class="mi">153</span> <span class="mi">235</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-62">  <span class="p">[</span><span class="mi">153</span> <span class="mi">235</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-63">  <span class="p">[</span><span class="mi">153</span> <span class="mi">235</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-64">  <span class="o">...</span>\
</span><span id="__span-32-65">  <span class="p">[</span><span class="mi">153</span> <span class="mi">236</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-66">  <span class="p">[</span><span class="mi">153</span> <span class="mi">236</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-67">  <span class="p">[</span><span class="mi">153</span> <span class="mi">236</span> <span class="mi">255</span><span class="p">]]</span>\
</span><span id="__span-32-68">\
</span><span id="__span-32-69"> <span class="p">[[</span><span class="mi">153</span> <span class="mi">235</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-70">  <span class="p">[</span><span class="mi">153</span> <span class="mi">235</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-71">  <span class="p">[</span><span class="mi">153</span> <span class="mi">235</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-72">  <span class="o">...</span>\
</span><span id="__span-32-73">  <span class="p">[</span><span class="mi">153</span> <span class="mi">236</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-74">  <span class="p">[</span><span class="mi">153</span> <span class="mi">236</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-75">  <span class="p">[</span><span class="mi">153</span> <span class="mi">236</span> <span class="mi">255</span><span class="p">]]</span>\
</span><span id="__span-32-76">\
</span><span id="__span-32-77"> <span class="p">[[</span><span class="mi">153</span> <span class="mi">235</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-78">  <span class="p">[</span><span class="mi">153</span> <span class="mi">235</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-79">  <span class="p">[</span><span class="mi">153</span> <span class="mi">235</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-80">  <span class="o">...</span>\
</span><span id="__span-32-81">  <span class="p">[</span><span class="mi">153</span> <span class="mi">236</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-82">  <span class="p">[</span><span class="mi">153</span> <span class="mi">236</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-83">  <span class="p">[</span><span class="mi">153</span> <span class="mi">236</span> <span class="mi">255</span><span class="p">]]</span>\
</span><span id="__span-32-84">\
</span><span id="__span-32-85"> <span class="o">...</span>\
</span><span id="__span-32-86">\
</span><span id="__span-32-87"> <span class="p">[[</span><span class="mi">153</span> <span class="mi">236</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-88">  <span class="p">[</span><span class="mi">153</span> <span class="mi">236</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-89">  <span class="p">[</span><span class="mi">153</span> <span class="mi">236</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-90">  <span class="o">...</span>\
</span><span id="__span-32-91">  <span class="p">[</span><span class="mi">153</span> <span class="mi">238</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-92">  <span class="p">[</span><span class="mi">153</span> <span class="mi">238</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-93">  <span class="p">[</span><span class="mi">153</span> <span class="mi">238</span> <span class="mi">255</span><span class="p">]]</span>\
</span><span id="__span-32-94">\
</span><span id="__span-32-95"> <span class="p">[[</span><span class="mi">153</span> <span class="mi">236</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-96">  <span class="p">[</span><span class="mi">153</span> <span class="mi">236</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-97">  <span class="p">[</span><span class="mi">153</span> <span class="mi">236</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-98">  <span class="o">...</span>\
</span><span id="__span-32-99">  <span class="p">[</span><span class="mi">153</span> <span class="mi">238</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-100">  <span class="p">[</span><span class="mi">153</span> <span class="mi">238</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-101">  <span class="p">[</span><span class="mi">153</span> <span class="mi">238</span> <span class="mi">255</span><span class="p">]]</span>\
</span><span id="__span-32-102">\
</span><span id="__span-32-103"> <span class="p">[[</span><span class="mi">153</span> <span class="mi">236</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-104">  <span class="p">[</span><span class="mi">153</span> <span class="mi">236</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-105">  <span class="p">[</span><span class="mi">153</span> <span class="mi">236</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-106">  <span class="o">...</span>\
</span><span id="__span-32-107">  <span class="p">[</span><span class="mi">153</span> <span class="mi">238</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-108">  <span class="p">[</span><span class="mi">153</span> <span class="mi">238</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-109">  <span class="p">[</span><span class="mi">153</span> <span class="mi">238</span> <span class="mi">255</span><span class="p">]]],</span> <span class="n">segmentations</span><span class="o">=</span><span class="p">[[[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-110">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-111">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-112">  <span class="o">...</span>\
</span><span id="__span-32-113">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-114">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-115">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]]</span>\
</span><span id="__span-32-116">\
</span><span id="__span-32-117"> <span class="p">[[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-118">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-119">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-120">  <span class="o">...</span>\
</span><span id="__span-32-121">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-122">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-123">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]]</span>\
</span><span id="__span-32-124">\
</span><span id="__span-32-125"> <span class="p">[[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-126">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-127">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-128">  <span class="o">...</span>\
</span><span id="__span-32-129">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-130">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-131">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]]</span>\
</span><span id="__span-32-132">\
</span><span id="__span-32-133"> <span class="o">...</span>\
</span><span id="__span-32-134">\
</span><span id="__span-32-135"> <span class="p">[[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-136">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-137">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-138">  <span class="o">...</span>\
</span><span id="__span-32-139">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-140">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-141">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]]</span>\
</span><span id="__span-32-142">\
</span><span id="__span-32-143"> <span class="p">[[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-144">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-145">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-146">  <span class="o">...</span>\
</span><span id="__span-32-147">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-148">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-149">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]]</span>\
</span><span id="__span-32-150">\
</span><span id="__span-32-151"> <span class="p">[[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-152">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-153">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-154">  <span class="o">...</span>\
</span><span id="__span-32-155">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-156">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]</span>\
</span><span id="__span-32-157">  <span class="p">[</span><span class="mi">255</span> <span class="mi">255</span> <span class="mi">255</span><span class="p">]]])</span>
</span></code></pre></div>
<p>The output contains a scalar anomaly score <code>pred_score</code>, a <code>pred_mask</code> denoting the predicted anomalous regions, and a heatmap <code>anomaly_map</code> showing the anomaly scores for each pixel. This is all valuable information for understanding the model’s predictions. The <code>run_inference()</code> function below will take a FiftyOne sample collection (e.g. our test set) as input, along with the inferencer object, and a key for storing the results in the samples. It will run the model on each sample in
the collection and store the results. The <code>threshold</code> argument acts as a cutoff for the anomaly score. If the score is above the threshold, the sample is considered anomalous. In this example, we’ll use a threshold of 0.50.5, but you can experiment with different values.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-33-1"><span class="p">[</span><span class="mi">24</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-34-1"><span class="k">def</span><span class="w"> </span><span class="nf">run_inference</span><span class="p">(</span><span class="n">sample_collection</span><span class="p">,</span> <span class="n">inferencer</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
</span><span id="__span-34-2">    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">sample_collection</span><span class="o">.</span><span class="n">iter_samples</span><span class="p">(</span><span class="n">autosave</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="__span-34-3">        <span class="n">output</span> <span class="o">=</span> <span class="n">inferencer</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">filepath</span><span class="p">))</span>
</span><span id="__span-34-4">
</span><span id="__span-34-5">        <span class="n">conf</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">pred_score</span>
</span><span id="__span-34-6">        <span class="n">anomaly</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span> <span class="k">if</span> <span class="n">conf</span> <span class="o">&lt;</span> <span class="n">threshold</span> <span class="k">else</span> <span class="s2">&quot;anomaly&quot;</span>
</span><span id="__span-34-7">
</span><span id="__span-34-8">        <span class="n">sample</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;pred_anomaly_score_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conf</span>
</span><span id="__span-34-9">        <span class="n">sample</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;pred_anomaly_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">Classification</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">anomaly</span><span class="p">)</span>
</span><span id="__span-34-10">        <span class="n">sample</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;pred_anomaly_map_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="nb">map</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">anomaly_map</span><span class="p">)</span>
</span><span id="__span-34-11">        <span class="n">sample</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;pred_defect_mask_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">Segmentation</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">pred_mask</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-35-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-36-1"><span class="n">run_inference</span><span class="p">(</span><span class="n">test_split</span><span class="p">,</span> <span class="n">inferencer</span><span class="p">,</span> <span class="s2">&quot;padim&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>Let’s visualize these results in the FiftyOne App:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-37-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-38-1"><span class="n">session</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">launch_app</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="n">test_split</span><span class="p">)</span>
</span></code></pre></div>
<p><img alt="Anomaly Detection PaDiM Results" src="../../_images/anomaly_detection_padim.gif" /></p>
<h2 id="evaluate-anomaly-detection-models">Evaluate Anomaly Detection Models <a href="#Evaluate-Anomaly-Detection-Models" title="Permalink to this headline">¶</a><a class="headerlink" href="#evaluate-anomaly-detection-models" title="Permanent link">&para;</a></h2>
<p>We have an anomaly detection model, but how do we know if it’s any good? For one, we can evaluate the model using metrics like precision, recall, and F1 score. FiftyOne’s <a href="https://docs.voxel51.com/user_guide/evaluation.html#">Evaluation API</a> makes this easy. We are going to evaluate the full-image classification performance of the model, as well as the segmentation performance.</p>
<p>We need to prepare our data for evaluation. First, we need to add null masks for the “normal” images to ensure the evaluation is fair:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-39-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-40-1"><span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">test_split</span><span class="o">.</span><span class="n">iter_samples</span><span class="p">(</span><span class="n">autosave</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="__span-40-2">    <span class="k">if</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;defect&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;good&quot;</span><span class="p">:</span>
</span><span id="__span-40-3">        <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;defect_mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">Segmentation</span><span class="p">(</span>
</span><span id="__span-40-4">            <span class="n">mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s2">&quot;pred_defect_mask_padim&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
</span><span id="__span-40-5">        <span class="p">)</span>
</span></code></pre></div>
<p>We also need to ensure consistency in naming/labels between ground truth and predictions. We’ll rename all of our “good” images to “normal” and every type of anomaly to “anomaly”:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-41-1"><span class="p">[</span><span class="mi">39</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-42-1"><span class="n">old_labels</span> <span class="o">=</span> <span class="n">test_split</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="s2">&quot;defect.label&quot;</span><span class="p">)</span>
</span><span id="__span-42-2"><span class="n">label_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span><span class="s2">&quot;anomaly&quot;</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">old_labels</span> <span class="k">if</span> <span class="n">label</span> <span class="o">!=</span> <span class="s2">&quot;good&quot;</span><span class="p">}</span>
</span><span id="__span-42-3"><span class="n">label_map</span><span class="p">[</span><span class="s2">&quot;good&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
</span><span id="__span-42-4"><span class="n">mapped_view</span> <span class="o">=</span> <span class="n">test_split</span><span class="o">.</span><span class="n">map_labels</span><span class="p">(</span><span class="s2">&quot;defect&quot;</span><span class="p">,</span> <span class="n">label_map</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-43-1"><span class="p">[</span><span class="mi">40</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-44-1"><span class="n">session</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">mapped_view</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
</span></code></pre></div>
<p><img alt="Mapped View" src="../../_images/anomaly_detection_mapped_labels.jpg" /></p>
<p>For classification, we’ll use binary evaluation, with “normal” as the negative class and “anomaly” as the positive class:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-45-1"><span class="p">[</span><span class="mi">41</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-46-1"><span class="n">eval_classif_padim</span> <span class="o">=</span> <span class="n">mapped_view</span><span class="o">.</span><span class="n">evaluate_classifications</span><span class="p">(</span>
</span><span id="__span-46-2">    <span class="s2">&quot;pred_anomaly_padim&quot;</span><span class="p">,</span>
</span><span id="__span-46-3">    <span class="n">gt_field</span><span class="o">=</span><span class="s2">&quot;defect&quot;</span><span class="p">,</span>
</span><span id="__span-46-4">    <span class="n">eval_key</span><span class="o">=</span><span class="s2">&quot;eval_classif_padim&quot;</span><span class="p">,</span>
</span><span id="__span-46-5">    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span>
</span><span id="__span-46-6">    <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="s2">&quot;anomaly&quot;</span><span class="p">],</span>
</span><span id="__span-46-7"><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-47-1"><span class="p">[</span><span class="mi">42</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-48-1"><span class="n">eval_classif_padim</span><span class="o">.</span><span class="n">print_report</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-49-1">              <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>
</span><span id="__span-49-2">
</span><span id="__span-49-3">      <span class="n">normal</span>       <span class="mf">0.95</span>      <span class="mf">0.90</span>      <span class="mf">0.92</span>        <span class="mi">20</span>
</span><span id="__span-49-4">     <span class="n">anomaly</span>       <span class="mf">0.97</span>      <span class="mf">0.98</span>      <span class="mf">0.98</span>        <span class="mi">63</span>
</span><span id="__span-49-5">
</span><span id="__span-49-6">    <span class="n">accuracy</span>                           <span class="mf">0.96</span>        <span class="mi">83</span>
</span><span id="__span-49-7">   <span class="n">macro</span> <span class="n">avg</span>       <span class="mf">0.96</span>      <span class="mf">0.94</span>      <span class="mf">0.95</span>        <span class="mi">83</span>
</span><span id="__span-49-8"><span class="n">weighted</span> <span class="n">avg</span>       <span class="mf">0.96</span>      <span class="mf">0.96</span>      <span class="mf">0.96</span>        <span class="mi">83</span>
</span></code></pre></div>
<p>The model performs quite well on the classification task!</p>
<p>If we go back over to the app and sort by anomaly score, we can see that certain types of anomalies tend to have higher scores than others. In this example, <code>contamination</code> instances tend to have either very high or very low scores relative to <code>broken_small</code> and <code>broken_large</code>. When we put this model in production we might be more likely to miss certain types of anomalies. Other types of models, or ensembles of models, might be more robust to this!</p>
<p>For segmentation evaluation, we will only be interested in pixel values of 00 (normal) and 255255 (anomaly), so we will filter our report for these “classes”:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-50-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-51-1"><span class="n">eval_seg_padim</span> <span class="o">=</span> <span class="n">mapped_view</span><span class="o">.</span><span class="n">evaluate_segmentations</span><span class="p">(</span>
</span><span id="__span-51-2">    <span class="s2">&quot;pred_defect_mask_padim&quot;</span><span class="p">,</span>
</span><span id="__span-51-3">    <span class="n">gt_field</span><span class="o">=</span><span class="s2">&quot;defect_mask&quot;</span><span class="p">,</span>
</span><span id="__span-51-4">    <span class="n">eval_key</span><span class="o">=</span><span class="s2">&quot;eval_seg_padim&quot;</span><span class="p">,</span>
</span><span id="__span-51-5"><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-52-1"><span class="p">[</span><span class="mi">44</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-53-1"><span class="n">eval_seg_padim</span><span class="o">.</span><span class="n">print_report</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">])</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-54-1">              <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>
</span><span id="__span-54-2">
</span><span id="__span-54-3">           <span class="mi">0</span>       <span class="mf">0.99</span>      <span class="mf">0.96</span>      <span class="mf">0.98</span> <span class="mf">63343269.0</span>
</span><span id="__span-54-4">         <span class="mi">255</span>       <span class="mf">0.60</span>      <span class="mf">0.89</span>      <span class="mf">0.72</span> <span class="mf">3886731.0</span>
</span><span id="__span-54-5">
</span><span id="__span-54-6">   <span class="n">micro</span> <span class="n">avg</span>       <span class="mf">0.96</span>      <span class="mf">0.96</span>      <span class="mf">0.96</span> <span class="mf">67230000.0</span>
</span><span id="__span-54-7">   <span class="n">macro</span> <span class="n">avg</span>       <span class="mf">0.80</span>      <span class="mf">0.93</span>      <span class="mf">0.85</span> <span class="mf">67230000.0</span>
</span><span id="__span-54-8"><span class="n">weighted</span> <span class="n">avg</span>       <span class="mf">0.97</span>      <span class="mf">0.96</span>      <span class="mf">0.96</span> <span class="mf">67230000.0</span>
</span></code></pre></div>
<h3 id="compare-anomaly-detection-models">Compare Anomaly Detection Models <a href="#Compare-Anomaly-Detection-Models" title="Permalink to this headline">¶</a><a class="headerlink" href="#compare-anomaly-detection-models" title="Permanent link">&para;</a></h3>
<p>Just because anomaly detection is unsupervised doesn’t mean we can’t compare models and choose the best one for our use case. We can train multiple models on the same data and compare their performance using metrics like F1 score, precision, and recall. We can also compare the models visually by inspecting the masks and heatmaps they generate.</p>
<p>Let’s repeat the training process for the <code>PatchCore</code> model and compare the two models:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-55-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-56-1"><span class="c1">## Train Patchcore model and run inference</span>
</span><span id="__span-56-2">
</span><span id="__span-56-3"><span class="n">model</span> <span class="o">=</span> <span class="n">Patchcore</span><span class="p">()</span>
</span><span id="__span-56-4">
</span><span id="__span-56-5"><span class="c1">## This will take a little longer to train, but should still be &lt; 5 minutes</span>
</span><span id="__span-56-6"><span class="n">inferencer</span> <span class="o">=</span> <span class="n">train_and_export_model</span><span class="p">(</span><span class="n">OBJECT</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</span><span id="__span-56-7">
</span><span id="__span-56-8"><span class="n">run_inference</span><span class="p">(</span><span class="n">mapped_view</span><span class="p">,</span> <span class="n">inferencer</span><span class="p">,</span> <span class="s2">&quot;patchcore&quot;</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-57-1"><span class="p">[</span><span class="mi">46</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-58-1"><span class="c1">## Evaluate Patchcore model on classification task</span>
</span><span id="__span-58-2"><span class="n">eval_classif_patchcore</span> <span class="o">=</span> <span class="n">mapped_view</span><span class="o">.</span><span class="n">evaluate_classifications</span><span class="p">(</span>
</span><span id="__span-58-3">    <span class="s2">&quot;pred_anomaly_patchcore&quot;</span><span class="p">,</span>
</span><span id="__span-58-4">    <span class="n">gt_field</span><span class="o">=</span><span class="s2">&quot;defect&quot;</span><span class="p">,</span>
</span><span id="__span-58-5">    <span class="n">eval_key</span><span class="o">=</span><span class="s2">&quot;eval_classif_patchcore&quot;</span><span class="p">,</span>
</span><span id="__span-58-6">    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span>
</span><span id="__span-58-7">    <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="s2">&quot;anomaly&quot;</span><span class="p">],</span>
</span><span id="__span-58-8"><span class="p">)</span>
</span><span id="__span-58-9">
</span><span id="__span-58-10"><span class="n">eval_classif_patchcore</span><span class="o">.</span><span class="n">print_report</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-59-1">              <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>
</span><span id="__span-59-2">
</span><span id="__span-59-3">      <span class="n">normal</span>       <span class="mf">0.95</span>      <span class="mf">1.00</span>      <span class="mf">0.98</span>        <span class="mi">20</span>
</span><span id="__span-59-4">     <span class="n">anomaly</span>       <span class="mf">1.00</span>      <span class="mf">0.98</span>      <span class="mf">0.99</span>        <span class="mi">63</span>
</span><span id="__span-59-5">
</span><span id="__span-59-6">    <span class="n">accuracy</span>                           <span class="mf">0.99</span>        <span class="mi">83</span>
</span><span id="__span-59-7">   <span class="n">macro</span> <span class="n">avg</span>       <span class="mf">0.98</span>      <span class="mf">0.99</span>      <span class="mf">0.98</span>        <span class="mi">83</span>
</span><span id="__span-59-8"><span class="n">weighted</span> <span class="n">avg</span>       <span class="mf">0.99</span>      <span class="mf">0.99</span>      <span class="mf">0.99</span>        <span class="mi">83</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-60-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-61-1"><span class="n">eval_seg_patchcore</span> <span class="o">=</span> <span class="n">mapped_view</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
</span><span id="__span-61-2">    <span class="n">F</span><span class="p">(</span><span class="s2">&quot;defect.label&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;anomaly&quot;</span>
</span><span id="__span-61-3"><span class="p">)</span><span class="o">.</span><span class="n">evaluate_segmentations</span><span class="p">(</span>
</span><span id="__span-61-4">    <span class="s2">&quot;pred_defect_mask_patchcore&quot;</span><span class="p">,</span>
</span><span id="__span-61-5">    <span class="n">gt_field</span><span class="o">=</span><span class="s2">&quot;defect_mask&quot;</span><span class="p">,</span>
</span><span id="__span-61-6">    <span class="n">eval_key</span><span class="o">=</span><span class="s2">&quot;eval_seg_patchcore&quot;</span><span class="p">,</span>
</span><span id="__span-61-7"><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-62-1"><span class="p">[</span><span class="mi">48</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-63-1"><span class="n">eval_seg_patchcore</span><span class="o">.</span><span class="n">print_report</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">])</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-64-1">              <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>
</span><span id="__span-64-2">
</span><span id="__span-64-3">           <span class="mi">0</span>       <span class="mf">0.99</span>      <span class="mf">0.95</span>      <span class="mf">0.97</span> <span class="mf">47143269.0</span>
</span><span id="__span-64-4">         <span class="mi">255</span>       <span class="mf">0.60</span>      <span class="mf">0.85</span>      <span class="mf">0.70</span> <span class="mf">3886731.0</span>
</span><span id="__span-64-5">
</span><span id="__span-64-6">   <span class="n">micro</span> <span class="n">avg</span>       <span class="mf">0.95</span>      <span class="mf">0.95</span>      <span class="mf">0.95</span> <span class="mf">51030000.0</span>
</span><span id="__span-64-7">   <span class="n">macro</span> <span class="n">avg</span>       <span class="mf">0.80</span>      <span class="mf">0.90</span>      <span class="mf">0.84</span> <span class="mf">51030000.0</span>
</span><span id="__span-64-8"><span class="n">weighted</span> <span class="n">avg</span>       <span class="mf">0.96</span>      <span class="mf">0.95</span>      <span class="mf">0.95</span> <span class="mf">51030000.0</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-65-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-66-1"><span class="n">session</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">mapped_view</span><span class="o">.</span><span class="n">shuffle</span><span class="p">()</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
</span></code></pre></div>
<p><img alt="Compare Models" src="../../_images/anomaly_detection_compare_models.gif" /></p>
<p>The metrics back up what we see in the app: PatchCore has much higher recall for the “anomaly” class, but lower precision. This means it’s more likely to catch anomalies, but also more likely to make false positive predictions. After all, PatchCore is designed for “total recall” in industrial anomaly detection.</p>
<p>Looking at the heatmaps, we can also see what types of anomalies each model is better at detecting. An ensemble of the two models might be more robust to different types of anomalies.</p>
<h2 id="test-data-augmentation-techniques">Test Data Augmentation Techniques <a href="#Test-Data-Augmentation-Techniques" title="Permalink to this headline">¶</a><a class="headerlink" href="#test-data-augmentation-techniques" title="Permanent link">&para;</a></h2>
<p>Beyond the anomaly detection algorithm itself, there are many other knobs we can turn to improve the performance of our model. These include:</p>
<ul>
<li>
<p>Backbone: The architecture of the model used for feature extraction</p>
</li>
<li>
<p>Algorithm hyperparameters: Parameters specific to the anomaly detection algorithm. For PatchCore, this includes <code>coreset_sampling_ratio</code> and <code>num_neighbors</code>.</p>
</li>
<li>
<p>Data augmentation: Techniques to artificially increase the size of the training set and improve the model’s generalization.</p>
</li>
</ul>
<p>This section briefly illustrates the role of data augmentation techniques in anomaly detection. We’ll use <a href="https://github.com/jacobmarks/fiftyone-albumentations-plugin">FiftyOne’s Albumentations plugin</a> to test and visualize transformations on “good” samples from the dataset and then apply the same transformations (with <code>torchvision.transforms</code>) to the training images.</p>
<p>The goal is to increase the diversity of the training set without changing the images so much that we verge into the “anomalous” territory.</p>
<p>First, let’s install <a href="https://albumentations.ai/docs/">Albumentations</a> and download the plugin:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-67-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-68-1"><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">U</span> <span class="n">albumentations</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-69-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-70-1"><span class="err">!</span><span class="n">fiftyone</span> <span class="n">plugins</span> <span class="n">download</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">jacobmarks</span><span class="o">/</span><span class="n">fiftyone</span><span class="o">-</span><span class="n">albumentations</span><span class="o">-</span><span class="n">plugin</span>
</span></code></pre></div>
<p>Refresh the FiftyOne App and hit the backtick key on your keyboard to open the operators list. Select <code>"augment_with_albumentations"</code> from the dropdown menu. Try applying transformations like <code>GaussianBlur</code>, and <code>ColorJitter</code>, and see how they affect the images. Use the <code>"view_last_albumentations_run"</code> operator to see the augmentations generated by the last run. Play around with the kernel size for blurring, and the brightness, contrast, and saturation values for color jittering.
Depending on the object category, it might also make sense to apply 90 degree rotations, horizontal flips, and other transformations!</p>
<p><img alt="Data Augmentation" src="../../_images/anomaly_detection_augment.gif" /></p>
<p>Once you’re happy with the transformations, use the <code>"get_last_albumentations_run_info"</code> operator to see the transformations applied and their parameters. You can then use these with <code>torchvision.transforms</code> to augment the training images.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-71-1"><span class="p">[</span><span class="mi">49</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-72-1"><span class="kn">from</span><span class="w"> </span><span class="nn">torchvision.transforms.v2</span><span class="w"> </span><span class="kn">import</span> <span class="n">GaussianBlur</span><span class="p">,</span> <span class="n">ColorJitter</span><span class="p">,</span> <span class="n">Compose</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-73-1"><span class="p">[</span><span class="mi">50</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-74-1"><span class="n">transform</span> <span class="o">=</span> <span class="n">Compose</span><span class="p">([</span>\
</span><span id="__span-74-2">    <span class="n">Resize</span><span class="p">(</span><span class="n">IMAGE_SIZE</span><span class="p">,</span> <span class="n">antialias</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>\
</span><span id="__span-74-3">    <span class="n">GaussianBlur</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>\
</span><span id="__span-74-4">    <span class="n">ColorJitter</span><span class="p">(</span><span class="n">brightness</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">contrast</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mf">0.2</span><span class="p">),</span>\
</span><span id="__span-74-5"><span class="p">])</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-75-1"><span class="p">[</span> <span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-76-1"><span class="n">model</span> <span class="o">=</span> <span class="n">Patchcore</span><span class="p">()</span>
</span><span id="__span-76-2"><span class="n">augmented_inferencer</span> <span class="o">=</span> <span class="n">train_and_export_model</span><span class="p">(</span>
</span><span id="__span-76-3">    <span class="n">OBJECT</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span>
</span><span id="__span-76-4"><span class="p">)</span>
</span><span id="__span-76-5">
</span><span id="__span-76-6"><span class="n">run_inference</span><span class="p">(</span><span class="n">mapped_view</span><span class="p">,</span> <span class="n">augmented_inferencer</span><span class="p">,</span> <span class="s2">&quot;patchcore_augmented&quot;</span><span class="p">)</span>
</span><span id="__span-76-7">
</span><span id="__span-76-8"><span class="n">session</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">mapped_view</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
</span></code></pre></div>
<p>This is just a starting point for data augmentation. You can experiment with different transformations and parameters to see what works best for your dataset.</p>
<h2 id="summary">Summary <a href="#Summary" title="Permalink to this headline">¶</a><a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>In this walkthrough, we learned how to perform anomaly detection on visual data using FiftyOne and Anomalib. We trained two anomaly detection models, PaDiM and PatchCore, on the MVTec AD dataset and evaluated their performance using metrics like precision, recall, and F1 score. We also visualized the models’ predictions using heatmaps and masks. Finally, we tested data augmentation techniques to improve the models’ generalization.</p>
<p>If you want to dive deeper into unsupervised learning, check out these tutorials:</p>
<ul>
<li>
<p><a href="https://docs.voxel51.com/tutorials/dimension_reduction.html">Visualizing Data with Dimensionality Reduction Techniques</a></p>
</li>
<li>
<p><a href="https://docs.voxel51.com/tutorials/clustering.html">Clustering Images with Embeddings</a></p>
</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-77-1"><span class="p">[</span><span class="mi">52</span><span class="p">]:</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-78-1"><span class="n">session</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">mapped_view</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
</span></code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.path", "navigation.indexes", "navigation.top", {"icon": {"repo": "fontawesome/brands/github"}}, "content.action.edit"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>